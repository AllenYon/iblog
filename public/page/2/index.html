<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Alin Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="做成一件有意义的事">
<meta property="og:type" content="website">
<meta property="og:title" content="Alin Blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Alin Blog">
<meta property="og:description" content="做成一件有意义的事">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Alin Blog">
<meta name="twitter:description" content="做成一件有意义的事">
    

    
        <link rel="alternate" href="/" title="Alin Blog" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Alin Blog</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Buscar" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Entradas',
            PAGES: 'Pages',
            CATEGORIES: 'Categorias',
            TAGS: 'Etiquetas',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Buscar" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/avatar.png" />
            <h2 id="name">阿霖</h2>
            <h3 id="title">产品经理&amp;程序员</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Hangzhou, China</span>
            <a id="follow" target="_blank" href="https://weibo.com/nvolume">SEGUIR</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                27
                <span>Entradas</span>
            </div>
            <div class="article-info-block">
                1
                <span>Etiqueta</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/linkyan" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-2013-06-07-fragmenttab" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/06/07/2013-06-07-fragmenttab/">Android ActionBar源码解析之FragmentTab</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/06/07/2013-06-07-fragmenttab/">
            <time datetime="2013-06-06T16:00:00.000Z" itemprop="datePublished">2013-06-07</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>在Android3.0以上以及android.support.v4包中包含了ActionBar这个控件，十分好用的一个模块就是它的<a href="http://developer.android.com/reference/android/app/ActionBar.Tab.html" target="_blank" rel="noopener">ActionBar.Tab</a>.<strong>但是</strong>，它将布局与Fragment的管理耦合在了一起，假如我们想定制的话，还是需要花费一点功夫的，所以我将它们解耦，简化了一下，单独拿了出来。点击查看：<a href="https://github.com/LinkYan/Android-FragmentTab" target="_blank" rel="noopener">Github：Android-FragmentTab</a></p>
<p>首先让我们看看FragmentTab的实现，不是很复杂：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">public class FragmentTab &#123;</span><br><span class="line">    FragmentManager mFragmentManager;</span><br><span class="line">    HashMap&lt;String, TabItem&gt; mTabItems = new HashMap&lt;String, TabItem&gt;();</span><br><span class="line">    TabItem mSelectedTabItem;</span><br><span class="line"></span><br><span class="line">    public FragmentTab(FragmentManager mFragmentManager) &#123;</span><br><span class="line">        this.mFragmentManager = mFragmentManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void addTabItem(TabItem item) &#123;</span><br><span class="line">        mTabItems.put(item.getTag(), item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void selectTab(String tag) &#123;</span><br><span class="line">        selectTab(mTabItems.get(tag));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void selectTab(TabItem tabItem) &#123;</span><br><span class="line"></span><br><span class="line">        final FragmentTransaction trans = mFragmentManager.beginTransaction()</span><br><span class="line">                .disallowAddToBackStack();</span><br><span class="line"></span><br><span class="line">        if (mSelectedTabItem == tabItem) &#123;</span><br><span class="line">            if (mSelectedTabItem != null) &#123;</span><br><span class="line">                mSelectedTabItem.onTabReselected(mSelectedTabItem, trans);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (mSelectedTabItem != null) &#123;</span><br><span class="line">                mSelectedTabItem.onTabUnselected(mSelectedTabItem, trans);</span><br><span class="line">            &#125;</span><br><span class="line">            mSelectedTabItem = tabItem;</span><br><span class="line">            if (mSelectedTabItem != null) &#123;</span><br><span class="line">                mSelectedTabItem.onTabSelected(mSelectedTabItem, trans);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (!trans.isEmpty()) &#123;</span><br><span class="line">            trans.commit();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出我们实际上只有两个方法可以调用<code>addTabItem(TabItem item)</code>和<code>selectTab(TabItem item)</code> ，一个添加tab和一个选择tab。</p>
<p>TabItem是一个抽象类,构造函数中的<code>Class&lt;T&gt; mClass</code>是Fragment的类，以及它的参数<code>Bundle mArgs</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public abstract class TabItem&lt;T&gt; implements TabListener &#123;</span><br><span class="line">    protected final Context mContext;</span><br><span class="line">    protected final String mTag;</span><br><span class="line">    protected final Class&lt;T&gt; mClass;</span><br><span class="line">    protected final Bundle mArgs;</span><br><span class="line">    protected Fragment mFragment;</span><br><span class="line"></span><br><span class="line">    public TabItem(Context ctx, String mTag, Class&lt;T&gt; mClass) &#123;</span><br><span class="line">        this(ctx, mTag, mClass, null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public TabItem(Context ctx, String mTag, Class&lt;T&gt; mClass, Bundle mArgs) &#123;</span><br><span class="line">        this.mContext = ctx;</span><br><span class="line">        this.mTag = mTag;</span><br><span class="line">        this.mClass = mClass;</span><br><span class="line">        this.mArgs = mArgs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTag() &#123;</span><br><span class="line">        return mTag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TabListener接口定义了3个方法，tab选中时，tab从选中切换到未被选中时，以及再次被选中时。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public interface TabListener &#123;</span><br><span class="line">    public void onTabSelected(TabItem tab, FragmentTransaction ft);</span><br><span class="line"></span><br><span class="line">    public void onTabUnselected(TabItem tab, FragmentTransaction ft);</span><br><span class="line"></span><br><span class="line">    public void onTabReselected(TabItem tab, FragmentTransaction ft);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后就是TabItem的实现了，默认行为与ActionBar.Tab是一致的，更多使用帮助：<a href="https://github.com/LinkYan/Android-FragmentTab" target="_blank" rel="noopener">Github：Android-FragmentTab</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public class TabItemImpl&lt;T&gt; extends TabItem&lt;T&gt; implements TabListener &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public TabItemImpl(Context ctx, String mTag, Class&lt;T&gt; mClass) &#123;</span><br><span class="line">        super(ctx, mTag, mClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public TabItemImpl(Context ctx, String mTag, Class&lt;T&gt; mClass, Bundle mArgs) &#123;</span><br><span class="line">        super(ctx, mTag, mClass, mArgs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onTabSelected(TabItem tab, FragmentTransaction ft) &#123;</span><br><span class="line">        if (mFragment == null) &#123;</span><br><span class="line">            mFragment = Fragment.instantiate(mContext, mClass.getName(), mArgs);</span><br><span class="line">            ft.add(R.id.layout_contain, mFragment, mTag);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            ft.attach(mFragment);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onTabUnselected(TabItem tab, FragmentTransaction ft) &#123;</span><br><span class="line">        if (mFragment != null) &#123;</span><br><span class="line">            ft.detach(mFragment);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onTabReselected(TabItem tab, FragmentTransaction ft) &#123;</span><br><span class="line">        //ToDo</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/06/07/2013-06-07-fragmenttab/" data-id="cjdnn3tlo000wrpfy9vbv3v0g" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-06-03-android-screen" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/06/03/2013-06-03-android-screen/">Android屏幕分辨率占有率分析及应用</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/06/03/2013-06-03-android-screen/">
            <time datetime="2013-06-02T16:00:00.000Z" itemprop="datePublished">2013-06-03</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>Android屏幕分辨率各种各样，碎片化严重，开发者苦不堪言，转身看看iOS开发同学，只要适配2个尺寸的屏幕就好了，= =！</p>
<p>但我们总是能克服的对不，假如我们现在有这么一个需求：</p>
<p>###我们将满屏显示一张网络图片，希望它不要失真或者被裁剪！</p>
<p>怎么做？先看看<a href="http://www.umindex.com/#android_resolution" target="_blank" rel="noopener">友盟的统计</a>:</p>
<table><br>    <tr><br>        <td>排名</td><br>        <td>分辨率</td><br>        <td>高宽比</td><br>        <td>占有率</td><br>    </tr><br>     <tr><br>        <td>1</td><br>        <td>800<em>480</em></td><br>        <td>1.66</td><br>        <td>37.7%</td><br>    </tr><br>     <tr><br>        <td>2</td><br>        <td>480320</td><br>        <td>1.5</td><br>        <td>25.4%</td><br>    </tr><br>     <tr><br>        <td>3</td><br>        <td>854<em>480</em></td><br>        <td>1.779</td><br>        <td>9.5%</td><br>    </tr><br>      <tr><br>        <td>4</td><br>        <td>1280720</td><br>        <td>1.777 </td><br>        <td>5.6%</td><br>    </tr><br>      <tr><br>        <td>5</td><br>        <td>960<em>540 </em></td><br>        <td>1.777</td><br>        <td>5.6%</td><br>    </tr><br>      <tr><br>        <td>6</td><br>        <td>320240</td><br>        <td>1.333</td><br>        <td>3.1%</td><br>    </tr><br>    <tr><br>        <td>7</td><br>        <td>1280<em>800</em></td><br>        <td>1.6</td><br>        <td>2.5%</td><br>    </tr><br>    <tr><br>        <td>8</td><br>        <td>1024600</td><br>        <td>1.706</td><br>        <td>1.3%</td><br>    </tr><br>    <tr><br>        <td>9</td><br>        <td>960<em>640</em></td><br>        <td>1.5</td><br>        <td>0.9%</td><br>    </tr><br>    <tr><br>        <td>10</td><br>        <td>1024768</td><br>        <td>1.3</td><br>        <td>0.5%</td><br>    </tr><br>    <tr><br>        <td>11</td><br>        <td>other</td><br>        <td>?</td><br>        <td>4.7%</td><br>    </tr><br></table>

<p>让我们合并下高宽比约等项，再排名：</p>
<table><br>    <tr><br>        <td>排名</td><br>        <td>高宽比</td><br>        <td>占有率</td><br>    </tr><br>     <tr><br>        <td>1</td><br>        <td>1.6~1.66</td><br>        <td>2.5%+37.7%=40.2%</td><br>    </tr><br>     <tr><br>        <td>2</td><br>        <td>1.5</td><br>        <td>25.4%+0.9%=26.3%</td><br>    </tr><br>     <tr><br>        <td>3</td><br>        <td>1.706~1.779</td><br>        <td>1.3%+8.8%+5.6%+9.5%=25.2%</td><br>    </tr><br>     <tr><br>        <td>4</td><br>        <td>1.3~1.333</td><br>        <td>0.5%~3.1%=3.6%</td><br>    </tr><br>     <tr><br>        <td>5</td><br>        <td>?</td><br>        <td>4.7%</td><br>    </tr><br></table>

<p>可以看出前三项占了91%!!!,况且1.333的屏幕是320*240这种小屏幕，好古董的屏幕，而且未知项中可能还包含前三项中的可能，所以如果我们忽略一些细节的话，最终情况是这样的：</p>
<table><br>    <tr><br>        <td>排名</td><br>        <td>分辨率</td><br>        <td>高宽比</td><br>        <td>占有率</td><br>    </tr><br>     <tr><br>        <td>1</td><br>        <td>800<em>480</em></td><br>        <td>1.66</td><br>        <td>40.2%</td><br>    </tr><br>     <tr><br>        <td>2</td><br>        <td>480320</td><br>        <td>1.5</td><br>        <td>26.3%</td><br>    </tr><br>     <tr><br>        <td>3</td><br>        <td>1280*720</td><br>        <td>1.777</td><br>        <td>25.2%</td><br>    </tr><br></table>


<p>有什么用呢?</p>
<p>###结论：假如这张网络请求下来的图片是设计师给出的，就请设计师对应着表3给出3套图，程序中我们动态算出手机屏幕的高宽比，根据高宽比对应选出最合适的图片，将scaleType设置为fitXY，这样就能做到最大程度的不失真了。</p>
<p>给一个写好的枚举类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">enum AspectRatio &#123;</span><br><span class="line">    SCALE_15, SCALE_166, SCALE_177;</span><br><span class="line"></span><br><span class="line">    public static AspectRatio getAspectRatio(float h2w) &#123;</span><br><span class="line">        if (h2w &lt;= 1.5f) &#123;</span><br><span class="line">            return AspectRatio.SCALE_15;</span><br><span class="line">        &#125; else if (h2w &gt; 1.5 &amp;&amp; h2w &lt;= 1.67) &#123;</span><br><span class="line">           return AspectRatio.SCALE_166;</span><br><span class="line">        &#125; else if (h2w &gt; 1.67) &#123;</span><br><span class="line">            return AspectRatio.SCALE_177;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">             return AspectRatio.SCALE_166;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/06/03/2013-06-03-android-screen/" data-id="cjdnn3tln000urpfygwy02tdw" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-05-31-cyclicbarrier" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/31/2013-05-31-cyclicbarrier/">Java并发之CyclicBarrier</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/31/2013-05-31-cyclicbarrier/">
            <time datetime="2013-05-30T16:00:00.000Z" itemprop="datePublished">2013-05-31</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>书摘：</p>
<p><code>CyclicBarrier</code>适用于这样的情况：你希望创建一组任务,他们并行地执行工作，然后在进行下一个步骤之前等待，直至所有任务都完成(看起来有些像join())。 它使得所有的并行任务都将在栅栏处列队，因此可以一致地向钱移动。这非常像CountDownLatch,只是CountDownLatch是只触发一次的事件，而CyclicBarrier可以多次重用。</p>
<p>刚开始接触计算机时开始，我就对仿真着了迷，而并发是使仿真成为可能的一个关键因素。记得我最开始编写的一个程序就是一个仿真：一个用BASIC编写的（由于文件名的限制而命名为HOSRAC.BAS的赛马游戏）。下面是那个程序的面向对象的多线程版本，其中使用了<code>CyclicBarrier</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">package cn.link.example;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Random;</span><br><span class="line">import java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line">class Horse implements Runnable &#123;</span><br><span class="line">    private static int counter = 0;</span><br><span class="line">    private final int id = counter++;</span><br><span class="line">    private int strides = 0;</span><br><span class="line">    private static Random rand = new Random(47);</span><br><span class="line">    private static CyclicBarrier barrier;</span><br><span class="line"></span><br><span class="line">    public Horse(CyclicBarrier b) &#123;</span><br><span class="line">        barrier = b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public synchronized int getStrides() &#123;</span><br><span class="line">        return strides;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        //ToDo</span><br><span class="line">        while (!Thread.interrupted()) &#123;</span><br><span class="line">            synchronized (this) &#123;</span><br><span class="line">                strides += rand.nextInt(3);</span><br><span class="line">            &#125;</span><br><span class="line">            try &#123;</span><br><span class="line">                barrier.await();</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();  //To change body of catch statement use File | Settings | File Templates.</span><br><span class="line">            &#125; catch (BrokenBarrierException e) &#123;</span><br><span class="line">                e.printStackTrace();  //To change body of catch statement use File | Settings | File Templates.</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Horse &quot; + id + &quot; &quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String tracks() &#123;</span><br><span class="line">        StringBuilder s = new StringBuilder();</span><br><span class="line">        for (int i = 0; i &lt; getStrides(); i++) &#123;</span><br><span class="line">            s.append(&quot;*&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        s.append(id);</span><br><span class="line">        return s.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class HorseRace &#123;</span><br><span class="line">    static final int FINISH_LINE = 80;</span><br><span class="line">    private List&lt;Horse&gt; horses = new ArrayList&lt;Horse&gt;();</span><br><span class="line">    private ExecutorService exec = Executors.newCachedThreadPool();</span><br><span class="line">    private CyclicBarrier barrier;</span><br><span class="line"></span><br><span class="line">    public HorseRace(int nHorses, final int pause) &#123;</span><br><span class="line">        barrier = new CyclicBarrier(nHorses, new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                //ToDo</span><br><span class="line">                StringBuilder s = new StringBuilder();</span><br><span class="line">                for (int i = 0; i &lt; FINISH_LINE; i++) &#123;</span><br><span class="line">                    s.append(&quot;=&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(s);</span><br><span class="line">                for (Horse horse : horses) &#123;</span><br><span class="line">                    System.out.println(horse.tracks());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                for (Horse horse : horses) &#123;</span><br><span class="line">                    if (horse.getStrides() &gt;= FINISH_LINE) &#123;</span><br><span class="line">                        System.out.println(horse + &quot;won!&quot;);</span><br><span class="line">                        exec.shutdownNow();</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                try &#123;</span><br><span class="line">                    TimeUnit.MILLISECONDS.sleep(pause);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();  //To change body of catch statement use File | Settings | File Templates.</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; nHorses; i++) &#123;</span><br><span class="line">            Horse horse = new Horse(barrier);</span><br><span class="line">            horses.add(horse);</span><br><span class="line">            exec.execute(horse);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        int nHorses = 7;</span><br><span class="line">        int pause = 200;</span><br><span class="line"></span><br><span class="line">//        if (args.length &gt; 0) &#123;</span><br><span class="line">//            int n = new Integer(args[0]);</span><br><span class="line">//            nHorses = n &gt; 0 ? n : nHorses;</span><br><span class="line">//        &#125;</span><br><span class="line">        new HorseRace(nHorses, pause);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以向CyclicBarrier提供一个“栅栏动作”，他是一个Runnable,当计数值到达0时自动执行–这是CyclicBarrier和CountDownLatch之间的另一个区别。这里，栅栏动作是作为匿名内部类创建的，它被提交给了CyclicBarrier的构造器。</p>
<p>我试图让每匹马都打印自己，但是之后的显示顺序取决于任务管理器。CyclicBarrier使得每匹马都要执行为了向前移动所必需执行的所有工作，然后必须在栅栏处等待其他所有的马都准备完毕。当所有的马都向前移动时，CyclicBarrier将自动调用Runnable栅栏动作任务，按顺序显示马和终点线的位置。</p>
<p>一旦所有的任务都越过了栅栏，它就会自动的为下一回合的比赛做好准备。</p>
<p>为了展示这个非常简单的动画效果，你需要将控制台视窗的尺寸调整为小到只有马时，才会展示出来。</p>
<p><a href="http://linkyan.com/2013/05/countdownlatch/" target="_blank" rel="noopener">链接:Java并发之CountDownLatch</a></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/31/2013-05-31-cyclicbarrier/" data-id="cjdnn3tll000qrpfyczwvp4vt" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-05-31-exceptioncenter" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/31/2013-05-31-exceptioncenter/">Android框架设计之ExceptionCenter</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/31/2013-05-31-exceptioncenter/">
            <time datetime="2013-05-30T16:00:00.000Z" itemprop="datePublished">2013-05-31</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="What’s-up"><a href="#What’s-up" class="headerlink" title="##What’s up?"></a>##What’s up?</h2><p>我们可能常常遇到这样的问题：</p>
<ol>
<li>http请求异常很多种，我们或者将他们归类包装，或者将他们一一抛到上层去处理，通常我们的应用会有很多层，API层,Cache层，业务层，界面层等等，层次越多需要将异常抛的层就越多，最终到达界面了再根据不同的异常渲染不同的页面效果。</li>
<li>某些异常不单单是提示用户就可以了的，还需要处理特定的业务或者与用户进行交互的，比如某用户被禁用了我们除了提示还需要将用户登出，清理数据等。</li>
<li>除了去处理异常，我们还需要对得到的异常分析，保存等定制操作，在哪里做比较合适，比较优雅？</li>
</ol>
<h2 id="So-How-to-solvoe-it"><a href="#So-How-to-solvoe-it" class="headerlink" title="So,How to solvoe it?"></a>So,How to solvoe it?</h2><hr>
<p>我们可以将需要在界面渲染的异常，跟踪保存的异常等统统扔到 ExceptionCenter中，通过<code>public boolean      fileter(Exception e)</code>函数过滤每一个异常，进行匹配。如果返回<code>true</code> 则在<code>public void handleException(Context ctx,Exception e)</code>函数中进行对应的逻辑处理，大概如此：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public abstract class LKException implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">    public abstract boolean filter(Exception e);</span><br><span class="line"></span><br><span class="line">    public abstract void handleException(Context ctx, Exception e);</span><br><span class="line"></span><br><span class="line">    public abstract void handleTargetException(Context ctx);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>implements Serializable</code>是为了能在Intent中传递。</p>
<p><code>ExceptionCenter</code>采用继承<code>BroadcastReceiver</code>异步来处理事件，大致是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">public class ExceptionCenter extends BroadcastReceiver &#123;</span><br><span class="line"></span><br><span class="line">    public static final String ACTION_EXCEPTION = &quot;com.huaban.exceptioncenter&quot;;</span><br><span class="line">    public static final String EXTRA_EXCEPTION = &quot;exception&quot;;</span><br><span class="line">    public static final String EXTRA_LKEXCEPTION = &quot;lkexception&quot;;</span><br><span class="line"></span><br><span class="line">    private ExceptionCenterFactory mFactory;</span><br><span class="line"></span><br><span class="line">    List&lt;Class&lt;? extends LKException&gt;&gt; mClazz = new ArrayList&lt;Class&lt;? extends LKException&gt;&gt;();</span><br><span class="line"></span><br><span class="line">    public ExceptionCenter(ExceptionCenterFactory factory) &#123;</span><br><span class="line">        super();</span><br><span class="line">        factory.onAddExceptionList(mClazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">        //ToDo</span><br><span class="line">        Exception exception = (Exception) intent.getSerializableExtra(EXTRA_EXCEPTION);</span><br><span class="line">        LKException lkException = (LKException) intent.getSerializableExtra(EXTRA_LKEXCEPTION);</span><br><span class="line">        if (lkException != null) &#123;</span><br><span class="line">            lkException.handleTargetException(context);</span><br><span class="line">        &#125; else if (exception != null) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                for (Class&lt;? extends LKException&gt; item : mClazz) &#123;</span><br><span class="line">                    LKException lk = item.newInstance();</span><br><span class="line">                    if (lk.filter(exception)) &#123;</span><br><span class="line">                        lk.handleException(context, exception);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (InstantiationException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到<code>onReceive()</code>函数中 处理异常有两种模式，一种是不需要进行过滤判断的，直接进行handle，一种是通过循环执行<code>lk.filter(exception)</code>判断是否需要进行处理。这是考虑到了开发者可以在ExceptionCenter先在外部进行判断再传进来处理，也可以在内部进行判断同时处理。</p>
<p>同时提供了几个类函数方便使用:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">private static BroadcastReceiver mBr;</span><br><span class="line"></span><br><span class="line">public static void start(Context ctx, ExceptionCenterFactory factory) &#123;</span><br><span class="line">	mBr = new ExceptionCenter(factory);</span><br><span class="line">    IntentFilter intentFilter = new IntentFilter(ACTION_EXCEPTION);</span><br><span class="line">    LocalBroadcastManager.getInstance(ctx).registerReceiver(mBr, intentFilter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void stop(Context ctx) &#123;</span><br><span class="line">	LocalBroadcastManager.getInstance(ctx).unregisterReceiver(mBr);</span><br><span class="line">    mBr = null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void recevieLKException(Context ctx, LKException exception) &#123;</span><br><span class="line">    Intent intent = new Intent(ACTION_EXCEPTION);</span><br><span class="line">    intent.putExtra(EXTRA_LKEXCEPTION, exception);</span><br><span class="line">    LocalBroadcastManager.getInstance(ctx).sendBroadcast(intent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void recevieException(Context ctx, Exception exception) &#123;</span><br><span class="line">    Intent intent = new Intent(ACTION_EXCEPTION);</span><br><span class="line">    intent.putExtra(EXTRA_EXCEPTION, exception);</span><br><span class="line">    LocalBroadcastManager.getInstance(ctx).sendBroadcast(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>start(Context ctx,ExceptionCenterFactroy factory)</code>在你的MainActivity的onCreate()中使用，</p>
<p><code>stop(context ctx)</code>在onDestory()中使用，因为使用了support.v4包中的<a href="http://developer.android.com/reference/android/support/v4/content/LocalBroadcastManager.html" target="_blank" rel="noopener">LocalBroadcatManager</a>类，所以这种方式比正常的BroadcastReceiver更加效率,Google原话：</p>
<blockquote>
<p>If you don’t need to send broadcasts across applications, consider using<br>this class with {@link android.support.v4.content.LocalBroadcastManager} instead<br>of the more general facilities described below.  This will give you a much<br>more efficient implementation (no cross-process communication needed) and allow<br>you to avoid thinking about any security issues related to other applications<br>being able to receive or send your broadcasts.</p>
</blockquote>
<p><code>ExceptionCenterFactory</code>只有一个抽象函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public abstract class ExceptionCenterFactory &#123;</span><br><span class="line">    public abstract void onAddExceptionList(List&lt;Class&lt;? extends LKException&gt;&gt; filterList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>开发者将需要过滤处理的类添加到队列中。</p>
<p>类似这中实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class WallpaperExceptionFactory extends ExceptionCenterFactory &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onAddExceptionList(List&lt;Class&lt;? extends LKException&gt;&gt; exceptionList) &#123;</span><br><span class="line">        //ToDo</span><br><span class="line">        exceptionList.add(AccountDisableException.class);</span><br><span class="line">        exceptionList.add(LKJSONException.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好的 来个简单的处理异常的类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public class AccountDisableException extends LKException &#123;</span><br><span class="line">    private static final String ACCOUNT_DISABLE = &quot;account_disable&quot;;</span><br><span class="line"></span><br><span class="line">    private String mMessage;</span><br><span class="line"></span><br><span class="line">    public AccountDisableException() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public AccountDisableException(String msg) &#123;</span><br><span class="line">        this.mMessage = msg;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean filter(Exception e) &#123;</span><br><span class="line">        if (e.getMessage().equals(&quot;account_disabled&quot;)) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;  //ToDo</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void handleException(Context ctx, Exception e) &#123;</span><br><span class="line">        //ToDo</span><br><span class="line">        Toast.makeText(ctx, &quot;account disable &quot; + e.getMessage(), Toast.LENGTH_SHORT).show();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void handleTargetException(Context ctx) &#123;</span><br><span class="line">        //ToDo</span><br><span class="line">        Toast.makeText(ctx, &quot;account disable target&quot; + mMessage, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于我们传进了<code>Context ctx</code>参数，实际上我们可以做任何有关Android的事情了。就看你怎么去做了。</p>
<h2 id="Last-word"><a href="#Last-word" class="headerlink" title="Last word"></a>Last word</h2><hr>
<p>多稚嫩的框架，这只是alpha版而已。慢慢来，先这么看看</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/31/2013-05-31-exceptioncenter/" data-id="cjdnn3tlm000srpfy3xgm2atq" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-05-22-parallaxscrollview" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/22/2013-05-22-parallaxscrollview/">Android中制作有景深视差的ScrollView</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/22/2013-05-22-parallaxscrollview/">
            <time datetime="2013-05-21T16:00:00.000Z" itemprop="datePublished">2013-05-22</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><img src="http://pic.yupoo.com/wsyanligang_v/CSz7cQTh/UZ5XO.png" width="330"></p>
<p>首先我们需要创建一个类继承ViewGroup，用来包含前景(ForgroundView)和后景(BackgourdView)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class ParallaxScrollView extends ViewGroup&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>接着是一个继承自ScrollView的类，每当<code>onScrollChanged()</code>触发时，都反馈给ParallaxScrollView。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class ObservableScrollView extends ScrollView&#123;</span><br><span class="line">	private ScrollCallbacks mCallbacks;</span><br><span class="line">	@Override</span><br><span class="line">    protected void onScrollChanged(int l, int t, int oldl, int oldt) &#123;</span><br><span class="line">        super.onScrollChanged(l, t, oldl, oldt);</span><br><span class="line">        if (mCallbacks != null) &#123;</span><br><span class="line">            mCallbacks.onScrollChanged(l, t, oldl, oldt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    static interface ScrollCallbacks &#123;</span><br><span class="line">        public void onScrollChanged(int l, int t, int oldl, int oldt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后如何使用呢？我们需要在xml中这样定义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;couk.jenxsol.parallaxscrollview.views.ParallaxScrollView&gt;</span><br><span class="line">	&lt;!--Background--&gt;</span><br><span class="line">	&lt;ImageView</span><br><span class="line">	    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:gravity=&quot;center&quot;</span><br><span class="line">        android:scaleType=&quot;fitXY&quot;</span><br><span class="line">        android:src=&quot;...&quot;/&gt;</span><br><span class="line">	&lt;!--Foreground--&gt;</span><br><span class="line">	&lt;couk.jenxsol.parallaxscrollview.views.ObservableScrollView&gt;</span><br><span class="line">		&lt;LinearLayout&gt;</span><br><span class="line">		&lt;/LinearLayout&gt;</span><br><span class="line">	&lt;couk.jenxsol.parallaxscrollview.views.ObservableScrollView/&gt;</span><br><span class="line">&lt;/couk.jenxsol.parallaxscrollview.views.ParallaxScrollView&gt;</span><br></pre></td></tr></table></figure>
<p>做到前后景视差，就需要当ScrollView滑动时，前景和后景滑动的距离不同，例如：前景正常向上滑动了10px,但是后景这时候只向上滑动3px，我们将这个变量定义为<code>mScrollDiff</code>,那么<code>mScrollDiff</code>等于0.3f。</p>
<p><code>ScrollView</code>的高度可以分为两部分，一个是<code>ScrollContentHeight</code>，ScrollView中包含的LinearLayout的高度，通常这个内容是很长的，一个是<code>ScollViewHeight</code>，通常就是我们屏幕的高再减去状态栏或者标题栏，即可见范围。以上我们称为前景。</p>
<p>后景就是我们的背景了，我们需要在每当前景滚动时，就动态改变后景的布局。</p>
<p>那我们就一步步解析如果做到前后景视差的ScrollView吧，首先在ParallaxScrollView完成布局填充后，我们完成一些初始化工作:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">protected void onFinishInflate() &#123;</span><br><span class="line">    super.onFinishInflate();</span><br><span class="line">    if (getChildCount() &gt; 2) &#123;</span><br><span class="line">        throw new IllegalStateException(&quot;ParallaxScrollView can host only two direct children&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    organiseViews();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>作者考虑到了如果开发者没有按照使用说明来编写xml的话的一些意外情况，我们现在暂时忽略。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">private void organiseViews() &#123;</span><br><span class="line">    if (getChildCount() &lt;= 0)</span><br><span class="line">        return;</span><br><span class="line">   // 将第一个子元素作为背景，第二个子元素作为前景</span><br><span class="line">       final View background = getChildAt(0);</span><br><span class="line">       final View foreground = getChildAt(1);</span><br><span class="line">       organiseBackgroundView(background);</span><br><span class="line">       organiseForgroundView(foreground);</span><br><span class="line">    &#125;</span><br><span class="line">private void organiseBackgroundView(final View background) &#123;</span><br><span class="line">    mBackground = background;</span><br><span class="line">&#125;</span><br><span class="line">private void organiseForgroundView(final View forground) &#123;</span><br><span class="line">	…</span><br><span class="line">    mScrollView = (ObservableScrollView) forground;</span><br><span class="line">	…</span><br><span class="line">    if (mScrollView != null) &#123;</span><br><span class="line">        mScrollView.setLayoutParams(forground.getLayoutParams());</span><br><span class="line">        mScrollView.setCallbacks(mScrollCallbacks);</span><br><span class="line">        mScrollView.setFillViewport(true);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每当ObservaleScrollView触发<code>onScrollChanged()</code>时，ParallaxScrollView都调用<br><code>requestLayout()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">private final ScrollCallbacks mScrollCallbacks = new ScrollCallbacks() &#123;</span><br><span class="line">   @Override</span><br><span class="line">   public void onScrollChanged(int l, int t, int oldl, int oldt) &#123;</span><br><span class="line">       requestLayout();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>接着就是最重要的<code>onMeasure()</code>和<code>onLayout()</code>函数了,他们分别计算出前景和后景的宽和高，以及每次调用<code>requestLayout()</code>时,<code>onLayout()</code>函数将视图放置在正确的位置上。首先看看<code>onMeasure()</code>函数做了什么事情：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">    super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">    if (mScrollView != null) &#123;</span><br><span class="line">      	measureChild(mScrollView,</span><br><span class="line">       		MeasureSpec.makeMeasureSpec(MeasureSpec.getSize(widthMeasureSpec), MeasureSpec.AT_MOST),</span><br><span class="line">           MeasureSpec.makeMeasureSpec(MeasureSpec.getSize(heightMeasureSpec), MeasureSpec.AT_MOST));</span><br><span class="line">        mScrollContentHeight = mScrollView.getChildAt(0).getMeasuredHeight();</span><br><span class="line">        mScrollViewHeight = mScrollView.getMeasuredHeight();</span><br><span class="line">    &#125;</span><br><span class="line">    if (mBackground != null) &#123;</span><br><span class="line">        int minHeight = 0;</span><br><span class="line">        minHeight = (int) (mScrollViewHeight +</span><br><span class="line">                mParallaxOffset * (mScrollContentHeight - mScrollViewHeight));</span><br><span class="line">        minHeight = Math.max(minHeight, MeasureSpec.getSize(heightMeasureSpec));</span><br><span class="line">        measureChild(mBackground,</span><br><span class="line">            MeasureSpec.makeMeasureSpec(MeasureSpec.getSize(widthMeasureSpec), MeasureSpec.EXACTLY),</span><br><span class="line">            MeasureSpec.makeMeasureSpec(minHeight, MeasureSpec.EXACTLY));</span><br><span class="line">        mBackgroundRight = getLeft() + mBackground.getMeasuredWidth();</span><br><span class="line">        mBackgroundBottom = getTop() + mBackground.getMeasuredHeight();</span><br><span class="line">        mScrollDiff = (float) (mBackground.getMeasuredHeight() - mScrollViewHeight)/(float) (mScrollContentHeight - mScrollViewHeight);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过调用<code>measureChild()</code>函数，我们就可以从<code>getMeasureHeight()</code>函数得到被计算之后的视图的高度。计算背景的minHeight时，使用了<code>Math.max()</code>进行了一次比较，这是因为有可能我们提供的背景原图的高度比拉伸后的背景还要高，这时候就需要选一个高度数值比较大的minHeight了。</p>
<p><code>mParallaxOffset</code>是对背景图片拉伸比例的变量，默认值为0.2f。<code>mScrollDiff</code>就是前景和后景的滑动比了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;</span><br><span class="line">    final int parentLeft = getPaddingLeft();</span><br><span class="line">    final int parentRight = right - left - getPaddingRight();</span><br><span class="line">    final int parentTop = getPaddingTop();</span><br><span class="line">    final int parentBottom = bottom - top - getPaddingBottom();</span><br><span class="line">    if (mScrollView != null &amp;&amp; mScrollView.getVisibility() != GONE) &#123;</span><br><span class="line">    	final int width = mScrollView.getMeasuredWidth();</span><br><span class="line">        final int height = mScrollView.getMeasuredHeight();</span><br><span class="line">        int childLeft=0;</span><br><span class="line">        int childTop=0;</span><br><span class="line">        //暂时省略gravity参数</span><br><span class="line">        mScrollView.layout(childLeft, childTop, childLeft + width, childTop + height);</span><br><span class="line">    &#125;</span><br><span class="line">    if (mBackground != null) &#123;</span><br><span class="line">        final int scrollYCenterOffset = -mScrollView.getScrollY();</span><br><span class="line">        final int offset = (int) (scrollYCenterOffset * mScrollDiff);</span><br><span class="line">        mBackground.layout(getLeft(), offset, mBackgroundRight, offset + mBackgroundBottom);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此所有要点都介绍完毕，你可以从<a href="https://github.com/chrisjenx/ParallaxScrollView" target="_blank" rel="noopener">Github:ParallaxScrollView</a>这个项目下载到全部详细的源码。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/22/2013-05-22-parallaxscrollview/" data-id="cjdnn3tlj000orpfyarrfsn9s" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-05-17-about-activeandroid" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/17/2013-05-17-about-activeandroid/">ActiveAndroid--Android轻量级ORM框架</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/17/2013-05-17-about-activeandroid/">
            <time datetime="2013-05-16T16:00:00.000Z" itemprop="datePublished">2013-05-17</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>Github:<a href="https://github.com/pardom/ActiveAndroid" target="_blank" rel="noopener">ActiveAndroid</a></p>
<p>ActiveAndroid算是一个轻量级的ORM框架，简单地通过如save()和delete()等方法来做到增删改查等操作。配置起来也还算简单。</p>
<p>下面是作者的原话：</p>
<blockquote>
<p>ActiveAndroid is an active record style ORM (object relational mapper). What does that mean exactly? Well, ActiveAndroid allows you to save and retrieve SQLite database records without ever writing a single SQL statement. Each database record is wrapped neatly into a class with methods like save() and delete().</p>
<p>ActiveAndroid does so much more than this though. Accessing the database is a hassle, to say the least, in Android. ActiveAndroid takes care of all the setup and messy stuff, and all with just a few simple steps of configuration.</p>
</blockquote>
<h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><hr>
<p>在AndroidManifest.xml中我们需要添加这两个<meta-data></meta-data></p>
<ul>
<li><code>AA_DB_NAME</code> (这个name不能改，但是是可选的，如果不写的话 是默认的”Application.db”这个值）</li>
<li><code>AA_DB_VERSION</code> (optional – defaults to 1)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest ...&gt;</span><br><span class="line">	&lt;application android:name=&quot;com.activeandroid.app.Application&quot; ...&gt;</span><br><span class="line">		...</span><br><span class="line">		&lt;meta-data android:name=&quot;AA_DB_NAME&quot; android:value=&quot;your.db&quot; /&gt;</span><br><span class="line">		&lt;meta-data android:name=&quot;AA_DB_VERSION&quot; android:value=&quot;5&quot; /&gt;</span><br><span class="line">	&lt;/application&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<p>这个<code>&lt;application&gt;</code>是必须指定的，但你也可以使用自己的Application,继承自<code>com.activeandroid.app.Application</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class MyApplication extends com.activeandroid.app.Application &#123; ...</span><br></pre></td></tr></table></figure>
<p>如果你不想或者不能继承<code>com.activeandroid.app.Application</code>的话，那么就这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class MyApplication extends SomeLibraryApplication &#123;</span><br><span class="line">	@Override</span><br><span class="line">	public void onCreate() &#123;</span><br><span class="line">		super.onCreate();</span><br><span class="line">		ActiveAndroid.initialize(this);</span><br><span class="line">	&#125;</span><br><span class="line">	@Override</span><br><span class="line">	public void onTerminate() &#123;</span><br><span class="line">		super.onTerminate();</span><br><span class="line">		ActiveAndroid.dispose();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ActiveAndroid.initialize(this)；</code>做初始化工作，<code>ActiveAndroid.dispose();</code>做清理工作</p>
<h2 id="创建数据库模型"><a href="#创建数据库模型" class="headerlink" title="##创建数据库模型"></a>##创建数据库模型</h2><p>我们使用<code>@Table(name = &quot;Items&quot;)</code>来表示表，使用<code>@Column(name = &quot;Name&quot;)</code>来表示列，ActiveAndroid会使用自增长的ID作为主键，然后按照注解描述，将类对应映射为数据库表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Table(name = &quot;Items&quot;)</span><br><span class="line">public class Item extends Model &#123;</span><br><span class="line">	@Column(name = &quot;Name&quot;)</span><br><span class="line">	public String name;</span><br><span class="line">	@Column(name = &quot;Category&quot;)</span><br><span class="line">	public Category category;</span><br><span class="line">        public Item()&#123;</span><br><span class="line">                super();</span><br><span class="line">        &#125;</span><br><span class="line">        public Item(String name, Category category)&#123;</span><br><span class="line">                super();</span><br><span class="line">                this.name = name;</span><br><span class="line">                this.category = category;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="依赖关系的数据库表"><a href="#依赖关系的数据库表" class="headerlink" title="依赖关系的数据库表"></a>依赖关系的数据库表</h3><p>假如Item和Category是多对一的关系，那么我们可以这样子创建他们的类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Table(name = &quot;Items&quot;)</span><br><span class="line">public class Item extends Model &#123;</span><br><span class="line">	@Column(name = &quot;Name&quot;)</span><br><span class="line">	public String name;</span><br><span class="line">	@Column(name = &quot;Category&quot;)</span><br><span class="line">	public Category category;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Table(name = &quot;Categories&quot;)</span><br><span class="line">public class Category extends Model &#123;</span><br><span class="line">	@Column(name = &quot;Name&quot;)</span><br><span class="line">	public String name;</span><br><span class="line">	public List&lt;Item&gt; items() &#123;</span><br><span class="line">		return getMany(Item.class, &quot;Category&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="如何保存和更新数据到数据库"><a href="#如何保存和更新数据到数据库" class="headerlink" title="如何保存和更新数据到数据库"></a>如何保存和更新数据到数据库</h2><hr>
<p>###单挑插入</p>
<p>保存Category对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Category restaurants = new Category();</span><br><span class="line">restaurants.name = &quot;Restaurants&quot;;</span><br><span class="line">restaurants.save();</span><br></pre></td></tr></table></figure>
<p>分配了一个category并且保存到数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Item item = new Item();</span><br><span class="line">item.category = restaurants;</span><br><span class="line">item.name = &quot;Outback Steakhouse&quot;;</span><br><span class="line">item.save();</span><br></pre></td></tr></table></figure></p>
<p>###批量插入</p>
<p>如果你要批量插入数据，最好使用事务(transaction)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ActiveAndroid.beginTransaction();</span><br><span class="line">try &#123;</span><br><span class="line">        for (int i = 0; i &lt; 100; i++) &#123;</span><br><span class="line">            Item item = new Item();</span><br><span class="line">            item.name = &quot;Example &quot; + i;</span><br><span class="line">            item.save();</span><br><span class="line">        &#125;</span><br><span class="line">        ActiveAndroid.setTransactionSuccessful();</span><br><span class="line">&#125;</span><br><span class="line">finally &#123;</span><br><span class="line">        ActiveAndroid.endTransaction();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用事务的话只用了 40ms，不然的话需要4秒。</p>
<p>###删除记录</p>
<p>我们有三种方式删除一条记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Item item = Item.load(Item.class, 1);</span><br><span class="line">item.delete();</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Item.delete(Item.class, 1);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new Delete().from(Item.class).where(&quot;Id = ?&quot;, 1).execute();</span><br></pre></td></tr></table></figure>
<p>很简单吧</p>
<h2 id="查询数据库"><a href="#查询数据库" class="headerlink" title="查询数据库"></a>查询数据库</h2><hr>
<p>作者将查询做的非常像SQLite的原生查询语句，几乎涵盖了所有的指令<br>com.activeandroid.query包下有以下类</p>
<ul>
<li>Delete</li>
<li>From</li>
<li>Join</li>
<li>Select</li>
<li>Set</li>
<li>Update</li>
</ul>
<p>我们举例说明吧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public static Item getRandom(Category category) &#123;</span><br><span class="line">	return new Select()</span><br><span class="line">		.from(Item.class)</span><br><span class="line">		.where(&quot;Category = ?&quot;, category.getId())</span><br><span class="line">		.orderBy(&quot;RANDOM()&quot;)</span><br><span class="line">		.executeSingle();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的sqlite查询语句就是 <code>select * from Item where Category = ? order by RANDOM()</code><br>当然还支持其他非常多的指令</p>
<ul>
<li>limit</li>
<li>offset</li>
<li>as</li>
<li>desc/asc</li>
<li>inner/outer/cross join</li>
<li>group by</li>
<li>having<br>等等</li>
</ul>
<p>大家可以在<strong>ActiveAndroid项目下的tests工程</strong>找到测试用例，有非常多详细的描述。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/17/2013-05-17-about-activeandroid/" data-id="cjdnn3tli000mrpfypfz1ikkv" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-05-15-app-widget" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/15/2013-05-15-app-widget/">Android开发者指南之App Widgets (译)</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/15/2013-05-15-app-widget/">
            <time datetime="2013-05-14T16:00:00.000Z" itemprop="datePublished">2013-05-15</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>App Widgets是一种能嵌入到其他应用程序(如Home screen)的小型应用程序界面，并且能接收定时的更新。这些视图被称为用户界面中的窗口小部件，需要App Widget provider才能发布.能持有其他App Widgets的应用组件叫做App Widget host.下面显示了一张Music App Widget的图。</p>
<p><img src="http://developer.android.com/images/appwidgets/appwidget.png" alt="music app widget"></p>
<p>本文档将描述如何使用App Widget provider发布一个App Widget。</p>
<blockquote>
<p>####Widget Design<br>更多关于如何设计你的app widget,你可以阅读这篇 <a href="http://developer.android.com/design/patterns/widgets.html" target="_blank" rel="noopener">窗口小部件设计指导</a>.</p>
</blockquote>
<h2 id="基础"><a href="#基础" class="headerlink" title="##基础"></a>##基础</h2><p>创建一个App Widget ，你需要以下条件:</p>
<ol>
<li>AppWidgetProviderInfo 对象。用来描述App Widget的元数据，比如App Widget的布局，更新频率，AppWidgetProvider类。也可以使用xml定义。</li>
<li>AppWidgetProvider 类实例。定义了一些基本方法，需要你去实现这些接口，是基于广播(broadcast)事件的。通过它，你可以接收到什么时候App Widget被更新了，可使用，不可使用和被删除了等状态。</li>
<li>界面布局。定义了为App Widget初始化的布局，定义在XML中。</li>
</ol>
<p>此外，你可以实现一个App Widget配置Activity。这个可选的Activity的主要作用是，当用户在启动器(launches)中添加了你的App Widget时允许他在创建的时候就修改App Widget的设置。</p>
<p>以下各节描述了如何设置每个组件</p>
<h2 id="在Manifest中声明一个App-Widget"><a href="#在Manifest中声明一个App-Widget" class="headerlink" title="##在Manifest中声明一个App Widget"></a>##在Manifest中声明一个App Widget</h2><p>首先，在你应用程序的AndroidManifest.xml文件中声明AppWidgetProvider类，像这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;receiver android:name=&quot;ExampleAppWidgetProvider&quot; &gt;</span><br><span class="line">    &lt;intent-filter&gt;</span><br><span class="line">        &lt;action android:name=&quot;android.appwidget.action.APPWIDGET_UPDATE&quot; /&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line">    &lt;meta-data android:name=&quot;android.appwidget.provider&quot;</span><br><span class="line">               android:resource=&quot;@xml/example_appwidget_info&quot; /&gt;</span><br><span class="line">&lt;/receiver&gt;</span><br></pre></td></tr></table></figure>
<p><code>&lt;receiver&gt;</code>元素需要android:name属性，用来指定App Widget所使用的AppWidgetProvider。</p>
<p><code>&lt;intent-filter&gt;</code>元素必须包含一个带有android:name属性的<code>&lt;action&gt;</code>元素。这个属性指定了AppWidgetProvider接收<code>ACTION_APPWIDGET_UPDATE</code>广播。这是你必须要显示声明的广播。AppWidgetManager会自动发生其他所有的App Widget广播到AppWidgetProvider中，如果有必要的话。</p>
<p><code>&lt;meta-data&gt;</code>元素指定了AppWidgetProviderInfo的来源并且要求有以下属性：</p>
<ul>
<li>android:name-指定元数据名称。使用<code>android.appwidget.provider</code>作为AppWidgetProviderInfo的描述来识别数据</li>
<li>android:resource-指定AppWidgetProviderInfo的本地来源</li>
</ul>
<h2 id="添加AppWidgetProviderInfo-元数据"><a href="#添加AppWidgetProviderInfo-元数据" class="headerlink" title="##添加AppWidgetProviderInfo 元数据"></a>##添加AppWidgetProviderInfo 元数据</h2><p>AppWidgetProviderInfo定义了一个App Widget必要的特性（qualities），例如最小的布局尺寸，初始布局资源，多久更新一次App Widget，创建时调用的配置Activity。可以使用单个<code>&lt;appwidget-provider&gt;</code>元素的XML资源来定义AppWidgetProviderInfo对象，然后保持到项目的<code>res/xml/</code>文件夹下。</p>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;appwidget-provider xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:minWidth=&quot;294dp&quot;</span><br><span class="line">    android:minHeight=&quot;72dp&quot;</span><br><span class="line">    android:updatePeriodMillis=&quot;86400000&quot;</span><br><span class="line">    android:previewImage=&quot;@drawable/preview&quot;</span><br><span class="line">    android:initialLayout=&quot;@layout/example_appwidget&quot;</span><br><span class="line">    android:configure=&quot;com.example.android.ExampleAppWidgetConfigure&quot;</span><br><span class="line">    android:resizeMode=&quot;horizontal|vertical&quot;</span><br><span class="line">    android:widgetCategory=&quot;home_screen|keyguard&quot;</span><br><span class="line">    android:initialKeyguardLayout=&quot;@layout/example_keyguard&quot;&gt;</span><br><span class="line">&lt;/appwidget-provider&gt;</span><br></pre></td></tr></table></figure>
<p>关于<code>&lt;appwidget-provider&gt;</code>属性的一些总结:</p>
<ul>
<li><code>miniWidth</code>和<code>minHeight</code></li>
<li><code>minResizeWidth</code>和<code>minResizeHeight</code></li>
<li><code>updatePeriodMillis</code></li>
<li><code>initialLayout</code></li>
<li><code>configure</code></li>
<li><code>perviewImage</code></li>
<li><code>autoAdvanceViewId</code></li>
<li><code>resizeMode</code></li>
<li><code>widgetCategory</code></li>
<li><code>initialKeyguardLayout</code></li>
</ul>
<p>关于更多`<appwidget-provider>可以接收的属性的相关信息，可以查看<a href="http://developer.android.com/reference/android/appwidget/AppWidgetProviderInfo.html" target="_blank" rel="noopener">AppWidgetProviderInfo</a>类。</appwidget-provider></p>
<h2 id="创建App-Widget布局"><a href="#创建App-Widget布局" class="headerlink" title="创建App Widget布局"></a>创建App Widget布局</h2><hr>
<p>你必须将你的App Widget初始化布局定义在XML中，并且将它保存在项目的<code>res/layout/</code>目录下。你可以使用下面列表列出的视图对象来设计你的App Widget,但是在你设计你的App Widget前，请先阅读并理解<a href="http://developer.android.com/guide/practices/ui_guidelines/widget_design.html" target="_blank" rel="noopener">App Widget Design Guidelines</a>。</p>
<p>创建一个App Widget布局是很简单的，如果你很了解<a href="http://developer.android.com/guide/topics/ui/declaring-layout.html" target="_blank" rel="noopener">Layouts</a>的话。但是你应该意识到App Widget是基于<a href="http://developer.android.com/reference/android/widget/RemoteViews.html" target="_blank" rel="noopener">RemoteViews</a>的，它不支持所有类型的布局和控件(view widget)。</p>
<p>一个RemoteViews对象(consequently 一个App Widget)可以支持以下的布局类:</p>
<ul>
<li>FrameLayout</li>
<li>LinearLayout</li>
<li>RelativeLayout</li>
<li>GridLayout</li>
</ul>
<p>和以下控件类:</p>
<ul>
<li>AnalogClock</li>
<li>Button</li>
<li>Chronometer</li>
<li>ImageButton</li>
<li>ImageView</li>
<li>ProgressBar</li>
<li>TextView</li>
<li>ViewFlipper</li>
<li>ListView</li>
<li>GridView</li>
<li>StackView</li>
<li>AdapterViewFlipper</li>
</ul>
<p>这些类的派生类(Descendants)是不支持的。</p>
<p>RemoteViews 也支持 ViewStub,一种不可见，不占大小的视图，你可以在运行时延迟<code>inflate</code>布局资源</p>
<h3 id="为App-Widget添加margins"><a href="#为App-Widget添加margins" class="headerlink" title="为App Widget添加margins"></a>为App Widget添加margins</h3><h2 id="使用AppWidgetProvider类"><a href="#使用AppWidgetProvider类" class="headerlink" title="使用AppWidgetProvider类"></a>使用AppWidgetProvider类</h2><hr>
<p>###接收App Widget广播意图 (broadcast intents)</p>
<h2 id="创建一个App-Widget配置Activity"><a href="#创建一个App-Widget配置Activity" class="headerlink" title="创建一个App Widget配置Activity"></a>创建一个App Widget配置Activity</h2><hr>
<p>###从配置Activity更新App Widget</p>
<h2 id="设置预览图片"><a href="#设置预览图片" class="headerlink" title="设置预览图片"></a>设置预览图片</h2><hr>
<h2 id="使App-Widget在锁屏上可用"><a href="#使App-Widget在锁屏上可用" class="headerlink" title="##使App Widget在锁屏上可用"></a>##使App Widget在锁屏上可用</h2><p>###改变大小指导</p>
<h2 id="使用带有集合的App-Widget"><a href="#使用带有集合的App-Widget" class="headerlink" title="##使用带有集合的App Widget"></a>##使用带有集合的App Widget</h2><p>Android 3.0引进了带有集合的App Widget。这种App Widget使用RemoteViewService去显示那些支持远程数据的集合,例如从content provider。由RemoteViewsService提供的数据展示在App Widget中使用了以下视图类型中的一种,我们称之为”collections views”</p>
<ul>
<li>ListView:A view that shows items in a vertically scrolling list. For an example, see the Gmail app widget.</li>
<li>GridView:A view that shows items in two-dimensional scrolling grid. For an example, see the Bookmarks app widget.</li>
<li>StackView:A stacked card view (kind of like a rolodex), where the user can flick the front card up/down to see the previous/next card, respectively. Examples include the YouTube and Books app widgets.</li>
<li>AdapterViewFlipper:An adapter-backed simple ViewAnimator that animates between two or more views. Only one child is shown at a time.</li>
</ul>
<p>正如上文所述,这些collections views显示支持远程数据的集合。这意味着他们使用Adpater将接口和数据<br>绑定一起。Adapter绑定将特殊items从一些集合的数据绑定到特殊的视图对象上。因为这些collection views被adapters支持，所以Android框架必须包含额外的体系结构去支持他们在app widget中使用。在app widget的上下文中，adapter被代替为RemoteViewsFactory,仅仅是简单的对Adapter接口进行了薄封装。当请求在集合中一个具体的item，RemoteViewsFactory会为集合创建并返回RemoteViews对象作为Item。为了能在你的app widget中使用collection view，你必须实现RemoteViewService和RemoteViewsFactory。</p>
<p>RemoteViewsService是一种允许一个远程adapter请求RemoteViews对象的service。<br>RemoteViewsFactory是一种为collections view（如ListView,GridView等）和视图中潜在数据做适配的接口。下面这段模板代码,你可以用实现service和interface，从StackView Widget sample中提取出来的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class StackWidgetService extends RemoteViewsService &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public RemoteViewsFactory onGetViewFactory(Intent intent) &#123;</span><br><span class="line">        return new StackRemoteViewsFactory(this.getApplicationContext(), intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class StackRemoteViewsFactory implements RemoteViewsService.RemoteViewsFactory &#123;</span><br><span class="line">//... include adapter-like methods here. See the StackView Widget sample.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="例子应用"><a href="#例子应用" class="headerlink" title="例子应用"></a>例子应用</h3><p>本节的代码片段取材至StackView Widget sample:</p>
<p><img src="http://developer.android.com/images/appwidgets/StackWidget.png" alt="sample"></p>
<p>例子有十个栈视图组成，从”0!”显示到”9!”。这个例子app widget有以下主要行为：</p>
<ul>
<li>用户可以垂直方向甩动在app widget的顶部View，来显示上一个或者下一个view。这是内建在StackView的行为。</li>
<li>Without any user interaction, the app widget automatically advances through its views in sequence, like a slide show. This is due to the setting android:autoAdvanceViewId=”@id/stack_view” in the res/xml/stackwidgetinfo.xml file. This setting applies to the view ID, which in this case is the view ID of the stack view.</li>
<li>If the user touches the top view, the app widget displays the Toast message “Touched view n,” where n is the index (position) of the touched view. For more discussion of how this is implemented, see Adding behavior to individual items.</li>
</ul>
<h3 id="实现带有集合的App-Widget"><a href="#实现带有集合的App-Widget" class="headerlink" title="实现带有集合的App Widget"></a>实现带有集合的App Widget</h3><p>To implement an App Widget with collections, you follow the same basic steps you would use to implement any app widget. The following sections describe the additional steps you need to perform to implement an App Widget with collections.</p>
<h3 id="带有集合的App-Widget的清单"><a href="#带有集合的App-Widget的清单" class="headerlink" title="带有集合的App Widget的清单"></a>带有集合的App Widget的清单</h3><p>In addition to the requirements listed in Declaring an App Widget in the Manifest, to make it possible for App Widgets with collections to bind to your RemoteViewsService, you must declare the service in your manifest file with the permission BIND_REMOTEVIEWS. This prevents other applications from freely accessing your app widget’s data. For example, when creating an App Widget that uses RemoteViewsService to populate a collection view, the manifest entry may look like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;service android:name=&quot;MyWidgetService&quot;</span><br><span class="line">...</span><br><span class="line">android:permission=&quot;android.permission.BIND_REMOTEVIEWS&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>The line <code>android:name=&quot;MyWidgetService&quot;</code> refers to your subclass of RemoteViewsService.</p>
<h3 id="带有集合的App-Widget的布局"><a href="#带有集合的App-Widget的布局" class="headerlink" title="带有集合的App Widget的布局"></a>带有集合的App Widget的布局</h3><p>The main requirement for your app widget layout XML file is that it include one of the collection views: ListView, GridView, StackView, or AdapterViewFlipper. Here is the widget_layout.xml for the StackView Widget sample:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;FrameLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line">    &lt;StackView xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">        android:id=&quot;@+id/stack_view&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:gravity=&quot;center&quot;</span><br><span class="line">        android:loopViews=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;TextView xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">        android:id=&quot;@+id/empty_view&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:gravity=&quot;center&quot;</span><br><span class="line">        android:background=&quot;@drawable/widget_item_background&quot;</span><br><span class="line">        android:textColor=&quot;#ffffff&quot;</span><br><span class="line">        android:textStyle=&quot;bold&quot;</span><br><span class="line">        android:text=&quot;@string/empty_view_text&quot;</span><br><span class="line">        android:textSize=&quot;20sp&quot; /&gt;</span><br><span class="line">&lt;/FrameLayout&gt;</span><br></pre></td></tr></table></figure>
<p>Note that empty views must be siblings of the collection view for which the empty view represents empty state.</p>
<p>In addition to the layout file for your entire app widget, you must create another layout file that defines the layout for each item in the collection (for example, a layout for each book in a collection of books). For example, the StackView Widget sample only has one layout file, widget_item.xml, since all items use the same layout. But the WeatherListWidget sample has two layout files: dark_widget_item.xml and light_widget_item.xml.</p>
<h3 id="带有集合的App-Widget的AppWidgetProvider"><a href="#带有集合的App-Widget的AppWidgetProvider" class="headerlink" title="带有集合的App Widget的AppWidgetProvider"></a>带有集合的App Widget的AppWidgetProvider</h3><p>As with a regular app widget, the bulk of your code in your AppWidgetProvider subclass typically goes in onUpdate(). The major difference in your implementation for onUpdate() when creating an app widget with collections is that you must call setRemoteAdapter(). This tells the collection view where to get its data. The RemoteViewsService can then return your implementation of RemoteViewsFactory, and the widget can serve up the appropriate data. When you call this method, you must pass an intent that points to your implementation of RemoteViewsService and the App Widget ID that specifies the app widget to update.</p>
<p>For example, here’s how the StackView Widget sample implements the onUpdate() callback method to set the RemoteViewsService as the remote adapter for the app widget collection:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public void onUpdate(Context context, AppWidgetManager appWidgetManager,</span><br><span class="line">int[] appWidgetIds) &#123;</span><br><span class="line">    // update each of the app widgets with the remote adapter</span><br><span class="line">    for (int i = 0; i &lt; appWidgetIds.length; ++i) &#123;     </span><br><span class="line">        // Set up the intent that starts the StackViewService, which will</span><br><span class="line">        // provide the views for this collection.</span><br><span class="line">        Intent intent = new Intent(context, StackWidgetService.class);</span><br><span class="line">        // Add the app widget ID to the intent extras.</span><br><span class="line">        intent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetIds[i]);</span><br><span class="line">        intent.setData(Uri.parse(intent.toUri(Intent.URI_INTENT_SCHEME)));</span><br><span class="line">        // Instantiate the RemoteViews object for the App Widget layout.</span><br><span class="line">        RemoteViews rv = new RemoteViews(context.getPackageName(), R.layout.widget_layout);</span><br><span class="line">        // Set up the RemoteViews object to use a RemoteViews adapter.</span><br><span class="line">        // This adapter connects</span><br><span class="line">        // to a RemoteViewsService  through the specified intent.</span><br><span class="line">        // This is how you populate the data.</span><br><span class="line">        rv.setRemoteAdapter(appWidgetIds[i], R.id.stack_view, intent);       </span><br><span class="line">        // The empty view is displayed when the collection has no items.</span><br><span class="line">        // It should be in the same layout used to instantiate the RemoteViews</span><br><span class="line">        // object above.</span><br><span class="line">        rv.setEmptyView(R.id.stack_view, R.id.empty_view);</span><br><span class="line">        //</span><br><span class="line">        // Do additional processing specific to this app widget...</span><br><span class="line">        //     </span><br><span class="line">        appWidgetManager.updateAppWidget(appWidgetIds[i], rv);   </span><br><span class="line">    &#125;</span><br><span class="line">    super.onUpdate(context, appWidgetManager, appWidgetIds);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="RemoteViewsService类"><a href="#RemoteViewsService类" class="headerlink" title="RemoteViewsService类"></a>RemoteViewsService类</h3><p>As described above, your RemoteViewsService subclass provides the RemoteViewsFactory used to populate the remote collection view.</p>
<p>Specifically, you need to perform these steps:</p>
<ol>
<li>Subclass RemoteViewsService. RemoteViewsService is the service through which a remote adapter can request RemoteViews.</li>
<li>In your RemoteViewsService subclass, include a class that implements the RemoteViewsFactory interface. RemoteViewsFactory is an interface for an adapter between a remote collection view (such as ListView, GridView, and so on) and the underlying data for that view. Your implementation is responsible for making a RemoteViews object for each item in the data set. This interface is a thin wrapper around Adapter.</li>
</ol>
<p>The primary contents of the RemoteViewsService implementation is its RemoteViewsFactory, described below.</p>
<h3 id="RemoteViewsFactory接口"><a href="#RemoteViewsFactory接口" class="headerlink" title="RemoteViewsFactory接口"></a>RemoteViewsFactory接口</h3><p>Your custom class that implements the RemoteViewsFactory interface provides the app widget with the data for the items in its collection. To do this, it combines your app widget item XML layout file with a source of data. This source of data could be anything from a database to a simple array. In the StackView Widget sample, the data source is an array of WidgetItems. The RemoteViewsFactory functions as an adapter to glue the data to the remote collection view.</p>
<p>The two most important methods you need to implement for your RemoteViewsFactory subclass are onCreate() and getViewAt() .</p>
<p>The system calls onCreate() when creating your factory for the first time. This is where you set up any connections and/or cursors to your data source. For example, the StackView Widget sample uses onCreate() to initialize an array of WidgetItem objects. When your app widget is active, the system accesses these objects using their index position in the array and the text they contain is displayed</p>
<p>Here is an excerpt from the StackView Widget sample’s RemoteViewsFactory implementation that shows portions of the onCreate() method:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class StackRemoteViewsFactory implements</span><br><span class="line">RemoteViewsService.RemoteViewsFactory &#123;</span><br><span class="line">    private static final int mCount = 10;</span><br><span class="line">    private List&lt;WidgetItem&gt; mWidgetItems = new ArrayList&lt;WidgetItem&gt;();</span><br><span class="line">    private Context mContext;</span><br><span class="line">    private int mAppWidgetId;</span><br><span class="line">    public StackRemoteViewsFactory(Context context, Intent intent) &#123;</span><br><span class="line">        mContext = context;</span><br><span class="line">        mAppWidgetId = intent.getIntExtra(AppWidgetManager.EXTRA_APPWIDGET_ID,</span><br><span class="line">                AppWidgetManager.INVALID_APPWIDGET_ID);</span><br><span class="line">    &#125;</span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        // In onCreate() you setup any connections / cursors to your data source. Heavy lifting,</span><br><span class="line">        // for example downloading or creating content etc, should be deferred to onDataSetChanged()</span><br><span class="line">        // or getViewAt(). Taking more than 20 seconds in this call will result in an ANR.</span><br><span class="line">        for (int i = 0; i &lt; mCount; i++) &#123;</span><br><span class="line">            mWidgetItems.add(new WidgetItem(i + &quot;!&quot;));</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>The RemoteViewsFactory method getViewAt() returns a RemoteViews object corresponding to the data at the specified position in the data set. Here is an excerpt from the StackView Widget sample’s RemoteViewsFactory implementation:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public RemoteViews getViewAt(int position) &#123;</span><br><span class="line">    // Construct a remote views item based on the app widget item XML file,</span><br><span class="line">    // and set the text based on the position.</span><br><span class="line">    RemoteViews rv = new RemoteViews(mContext.getPackageName(), R.layout.widget_item);</span><br><span class="line">    rv.setTextViewText(R.id.widget_item, mWidgetItems.get(position).text);</span><br><span class="line">    ...</span><br><span class="line">    // Return the remote views object.</span><br><span class="line">    return rv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="为个别Item添加行为"><a href="#为个别Item添加行为" class="headerlink" title="为个别Item添加行为"></a>为个别Item添加行为</h3><p>The above sections show you how to bind your data to your app widget collection. But what if you want to add dynamic behavior to the individual items in your collection view?</p>
<p>As described in Using the AppWidgetProvider Class, you normally use setOnClickPendingIntent() to set an object’s click behavior—such as to cause a button to launch an Activity. But this approach is not allowed for child views in an individual collection item (to clarify, you could use setOnClickPendingIntent() to set up a global button in the Gmail app widget that launches the app, for example, but not on the individual list items). Instead, to add click behavior to individual items in a collection, you use setOnClickFillInIntent(). This entails setting up up a pending intent template for your collection view, and then setting a fill-in intent on each item in the collection via your RemoteViewsFactory.</p>
<p>This section uses the StackView Widget sample to describe how to add behavior to individual items. In the StackView Widget sample, if the user touches the top view, the app widget displays the Toast message “Touched view n,” where n is the index (position) of the touched view. This is how it works:</p>
<ul>
<li>The StackWidgetProvider (an AppWidgetProvider subclass) creates a pending intent that has a custom action called TOAST_ACTION.</li>
<li>When the user touches a view, the intent is fired and it broadcasts TOAST_ACTION.</li>
<li>This broadcast is intercepted by the StackWidgetProvider’s onReceive() method, and the app widget displays the Toast message for the touched view. The data for the collection items is provided by the RemoteViewsFactory, via the RemoteViewsService.</li>
</ul>
<blockquote>
<p>Note: The StackView Widget sample uses a broadcast, but typically an app widget would simply launch an activity in a scenario like this one.</p>
</blockquote>
<h4 id="设置待定意图模板-pending-intent-template"><a href="#设置待定意图模板-pending-intent-template" class="headerlink" title="设置待定意图模板(pending intent template)"></a>设置待定意图模板(pending intent template)</h4><p>StackWidgetProvider（AppWidgetProvider子类）设置了一个待定意图.集合中具体的Item不能单独设置属于他们自己的待定意图。(注：性能原因) 取而代之的，集合作为一个整体设置一个待定意图模板，然后具体的Item设置填充意图(fill-in intent)来创建在item-by-item<br>The StackWidgetProvider (AppWidgetProvider subclass) sets up a pending intent. Individuals items of a collection cannot set up their own pending intents. Instead, the collection as a whole sets up a pending intent template, and the individual items set a fill-in intent to create unique behavior on an item-by-item basis.</p>
<p>This class also receives the broadcast that is sent when the user touches a view. It processes this event in its onReceive() method. If the intent’s action is TOAST_ACTION, the app widget displays a Toast message for the current view.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">public class StackWidgetProvider extends AppWidgetProvider &#123;</span><br><span class="line">    public static final String TOAST_ACTION = &quot;com.example.android.stackwidget.TOAST_ACTION&quot;;</span><br><span class="line">    public static final String EXTRA_ITEM = &quot;com.example.android.stackwidget.EXTRA_ITEM&quot;;</span><br><span class="line">    ...</span><br><span class="line">    // Called when the BroadcastReceiver receives an Intent broadcast.</span><br><span class="line">    // Checks to see whether the intent&apos;s action is TOAST_ACTION. If it is, the app widget</span><br><span class="line">    // displays a Toast message for the current item.</span><br><span class="line">    @Override</span><br><span class="line">    public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">        AppWidgetManager mgr = AppWidgetManager.getInstance(context);</span><br><span class="line">        if (intent.getAction().equals(TOAST_ACTION)) &#123;</span><br><span class="line">            int appWidgetId = intent.getIntExtra(AppWidgetManager.EXTRA_APPWIDGET_ID,</span><br><span class="line">                AppWidgetManager.INVALID_APPWIDGET_ID);</span><br><span class="line">            int viewIndex = intent.getIntExtra(EXTRA_ITEM, 0);</span><br><span class="line">            Toast.makeText(context, &quot;Touched view &quot; + viewIndex, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">        super.onReceive(context, intent);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void onUpdate(Context context, AppWidgetManager appWidgetManager, int[] appWidgetIds) &#123;</span><br><span class="line">        // update each of the app widgets with the remote adapter</span><br><span class="line">        for (int i = 0; i &lt; appWidgetIds.length; ++i) &#123;</span><br><span class="line">            // Sets up the intent that points to the StackViewService that will</span><br><span class="line">            // provide the views for this collection.</span><br><span class="line">            Intent intent = new Intent(context, StackWidgetService.class);</span><br><span class="line">            intent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetIds[i]);</span><br><span class="line">            // When intents are compared, the extras are ignored, so we need to embed the extras</span><br><span class="line">            // into the data so that the extras will not be ignored.</span><br><span class="line">            intent.setData(Uri.parse(intent.toUri(Intent.URI_INTENT_SCHEME)));</span><br><span class="line">            RemoteViews rv = new RemoteViews(context.getPackageName(), R.layout.widget_layout);</span><br><span class="line">            rv.setRemoteAdapter(appWidgetIds[i], R.id.stack_view, intent);</span><br><span class="line">            // The empty view is displayed when the collection has no items. It should be a sibling</span><br><span class="line">            // of the collection view.</span><br><span class="line">            rv.setEmptyView(R.id.stack_view, R.id.empty_view);</span><br><span class="line">            // This section makes it possible for items to have individualized behavior.</span><br><span class="line">            // It does this by setting up a pending intent template. Individuals items of a collection</span><br><span class="line">            // cannot set up their own pending intents. Instead, the collection as a whole sets</span><br><span class="line">            // up a pending intent template, and the individual items set a fillInIntent</span><br><span class="line">            // to create unique behavior on an item-by-item basis.</span><br><span class="line">            Intent toastIntent = new Intent(context, StackWidgetProvider.class);</span><br><span class="line">            // Set the action for the intent.</span><br><span class="line">            // When the user touches a particular view, it will have the effect of</span><br><span class="line">            // broadcasting TOAST_ACTION.</span><br><span class="line">            toastIntent.setAction(StackWidgetProvider.TOAST_ACTION);</span><br><span class="line">            toastIntent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetIds[i]);</span><br><span class="line">            intent.setData(Uri.parse(intent.toUri(Intent.URI_INTENT_SCHEME)));</span><br><span class="line">            PendingIntent toastPendingIntent = PendingIntent.getBroadcast(context, 0, toastIntent,</span><br><span class="line">                PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line">            rv.setPendingIntentTemplate(R.id.stack_view, toastPendingIntent);</span><br><span class="line">            appWidgetManager.updateAppWidget(appWidgetIds[i], rv);</span><br><span class="line">        &#125;</span><br><span class="line">    super.onUpdate(context, appWidgetManager, appWidgetIds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="设置填充意图-fill-in-intent"><a href="#设置填充意图-fill-in-intent" class="headerlink" title="设置填充意图(fill-in intent)"></a>设置填充意图(fill-in intent)</h4><p>你的RemoteViewsFactory必须为每一个在集合中的item设置一个填充意图(fill-in intent)。这样才可能做到区分给定的Item单独的点击动作。填充意图然后与待定意图模板(PendingItent template)结合一起，确定了当item被点击时将执行的最终意图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">public class StackWidgetService extends RemoteViewsService &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public RemoteViewsFactory onGetViewFactory(Intent intent) &#123;</span><br><span class="line">        return new StackRemoteViewsFactory(this.getApplicationContext(), intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class StackRemoteViewsFactory implements RemoteViewsService.RemoteViewsFactory &#123;</span><br><span class="line">    private static final int mCount = 10;</span><br><span class="line">    private List&lt;WidgetItem&gt; mWidgetItems = new ArrayList&lt;WidgetItem&gt;();</span><br><span class="line">    private Context mContext;</span><br><span class="line">    private int mAppWidgetId;</span><br><span class="line">    public StackRemoteViewsFactory(Context context, Intent intent) &#123;</span><br><span class="line">        mContext = context;</span><br><span class="line">        mAppWidgetId = intent.getIntExtra(AppWidgetManager.EXTRA_APPWIDGET_ID,</span><br><span class="line">                AppWidgetManager.INVALID_APPWIDGET_ID);</span><br><span class="line">    &#125;</span><br><span class="line">    // 初始化数据</span><br><span class="line">        public void onCreate() &#123;</span><br><span class="line">            // 在 onCreate()你可以建立任何连接/游标 到你的源数据中.Heavy lifting.</span><br><span class="line">            // 如下载或者创建内容等，应该延迟到onDataSetChanged()方法中</span><br><span class="line">            // 或者 getViewAt(), 在这个回调中耗时超过20秒，将会引起ANR.</span><br><span class="line">            for (int i = 0; i &lt; mCount; i++) &#123;</span><br><span class="line">                mWidgetItems.add(new WidgetItem(i + &quot;!&quot;));</span><br><span class="line">            &#125;</span><br><span class="line">           ...</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">        // Given the position (index) of a WidgetItem in the array, use the item&apos;s text value in</span><br><span class="line">        // combination with the app widget item XML file to construct a RemoteViews object.</span><br><span class="line">        public RemoteViews getViewAt(int position) &#123;</span><br><span class="line">            // position will always range from 0 to getCount() - 1.</span><br><span class="line">            // Construct a RemoteViews item based on the app widget item XML file, and set the</span><br><span class="line">            // text based on the position.</span><br><span class="line">            RemoteViews rv = new RemoteViews(mContext.getPackageName(), R.layout.widget_item);</span><br><span class="line">            rv.setTextViewText(R.id.widget_item, mWidgetItems.get(position).text);</span><br><span class="line">            // Next, set a fill-intent, which will be used to fill in the pending intent template</span><br><span class="line">            // that is set on the collection view in StackWidgetProvider.</span><br><span class="line">            Bundle extras = new Bundle();</span><br><span class="line">            extras.putInt(StackWidgetProvider.EXTRA_ITEM, position);</span><br><span class="line">            Intent fillInIntent = new Intent();</span><br><span class="line">            fillInIntent.putExtras(extras);</span><br><span class="line">            // Make it possible to distinguish the individual on-click</span><br><span class="line">            // action of a given item</span><br><span class="line">            rv.setOnClickFillInIntent(R.id.widget_item, fillInIntent);</span><br><span class="line">            ...</span><br><span class="line">            // Return the RemoteViews object.</span><br><span class="line">            return rv;</span><br><span class="line">        &#125;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="保持集合数据最新"><a href="#保持集合数据最新" class="headerlink" title="保持集合数据最新"></a>保持集合数据最新</h2><p>下面的流程图发生在一个使用了集合的App Widget更新数据时。它展示了App Widget代码与RemoteViewsFactory的交互，以及你如何触发更新。</p>
<p><img src="http://developer.android.com/images/appwidgets/appwidget_collections.png" alt="fresh data"></p>
<p>使用了集合的App Widgets的其中一个特性就是可以为用户提供最新的内容。例如，Android 3.0 Gmail app widget，可以为用户提供他们收件箱的一个快照。为了做到这一点，你需要能触发你的RemoteViewsFactory和集合view,去获得并且显示新数据。你可以通过使用AppWidgetManager调用notifyAppWidgetViewDataChanged()来实现这一点。然后在你的RemoteViewsFactory的OnDataChanged()获得一个回调结果，一个你有机会可以获取任何新数据的回调接口。注意，你可以在onDataSetChanged()回调方法中执行密集的同步操作(processing-intensive operations synchronously)。回调方法在元数据或者视图数据从RemoteViewsFactory那里获取之前以及被执行完成，所以你可以放心。此外，你也可以在getViewAt()方法内执行密集的同步操作。<strong>如果这个回调函数执行了很长时间，那么加载视图(RemoteViewsFactory中指定的getLoadingView()方法)将被显示在集合视图中正确的位置，直到它返回结果.</strong></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/15/2013-05-15-app-widget/" data-id="cjdnn3tlh000lrpfyfglz1auu" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-05-14-countdownlatch" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/14/2013-05-14-countdownlatch/">Java并发之CountDownLatch</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/14/2013-05-14-countdownlatch/">
            <time datetime="2013-05-13T16:00:00.000Z" itemprop="datePublished">2013-05-14</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>书摘：</p>
<p>CountDownLatch被用来同步一个或多个任务，强制他们等待由其他任务执行的一组操作完成。</p>
<p>你可以向CountDownLatch对象设置一个初始计数值，任务在这个对象上调用wati()的方法都将阻塞，知道这个计数值达到0。其他任务在结束其工作时，可以在该对象上调用countDown()来减少这个计数值。CountDownLatch被设计为只触发一次，计数值不能被重置。如果你需要能够重置计数值的版本，则可以使用<a href="http://linkyan.com/4000/2013/05/cyclicbarrier/" target="_blank" rel="noopener">CyclicBarrier</a>。</p>
<p>调用countDown()的任务在产生这个调用时并没有被阻塞，只有对await()的调用会被阻塞，直到计数值达到0。</p>
<p>CountDownLatch的典型用法是将一个程序分为n个互相独立的可解决任务，并创建值为0的CountDownLatch。当每个任务完成是，都会在这个锁存器上调用countDown()。等待问题被解决的任务在这个锁存器上调用await()，将他们自己拦住，知道锁存器计数结束。下面演示这种技术的一个框架示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">class TaskProtion implements Runnable &#123;</span><br><span class="line">    private static int counter = 0;</span><br><span class="line">    private final int id = counter++;</span><br><span class="line">    private static Random rand = new Random(47);</span><br><span class="line">    private final CountDownLatch latch;</span><br><span class="line"></span><br><span class="line">    TaskProtion(CountDownLatch latch) &#123;</span><br><span class="line">        this.latch = latch;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        //ToDo</span><br><span class="line">        try &#123;</span><br><span class="line">            dowork();</span><br><span class="line">            latch.countDown();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void dowork() throws InterruptedException &#123;</span><br><span class="line">        TimeUnit.MILLISECONDS.sleep(rand.nextInt(2000));</span><br><span class="line">        System.out.println(this + &quot;completed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return String.format(&quot;%1$-3d&quot;, id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class WaitingTask implements Runnable &#123;</span><br><span class="line">    private static int counter = 0;</span><br><span class="line">    private final int id = counter++;</span><br><span class="line">    private final CountDownLatch latch;</span><br><span class="line"></span><br><span class="line">    WaitingTask(CountDownLatch latch) &#123;</span><br><span class="line">        this.latch = latch;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        //ToDo</span><br><span class="line">        try &#123;</span><br><span class="line">            latch.await();</span><br><span class="line">            System.out.println(&quot;Latch barrier passed for &quot; + this);</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return String.format(&quot;WaitingTask %1$-3d &quot;, id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class CountDownLatchDemo &#123;</span><br><span class="line">    static final int SIZE = 100;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        ExecutorService exec = Executors.newCachedThreadPool();</span><br><span class="line">        CountDownLatch latch = new CountDownLatch(SIZE);</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">            exec.execute(new WaitingTask(latch));</span><br><span class="line">        &#125;</span><br><span class="line">        for (int i = 0; i &lt; SIZE; i++) &#123;</span><br><span class="line">            exec.execute(new TaskProtion(latch));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;Launched all tasks &quot;);</span><br><span class="line">        exec.shutdown();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TaskPortion将随即地休眠一段时间，以模拟这部分工作的完成，而WaitingTask表示系统中，必须等待的部分，它要等待到问题的初始部分完成为止。所有任务都使用了在main()中定义的同一个单一的CountDownLatch。</p>
<p><a href="http://linkyan.com/2013/05/cyclicbarrier/" target="_blank" rel="noopener">链接:Java并发之CyclicBarrier</a></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/14/2013-05-14-countdownlatch/" data-id="cjdnn3tkn000brpfy43twa6bl" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-05-14-lazylistview" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/14/2013-05-14-lazylistview/">Lazy ListView--细化ListView加载图片策略</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/14/2013-05-14-lazylistview/">
            <time datetime="2013-05-13T16:00:00.000Z" itemprop="datePublished">2013-05-14</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>使用ListView控件来加载图片时，我们一般会使用异步加载的方式。但是如果我们滑动过快的话，可能会超出AsyncTask最大128个线程的限制，然后报异常，FC。于是我们可以使用<figure class="highlight plain"><figcaption><span>有实现这样的逻辑。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">但是我将细化这个加载策略</span><br><span class="line"></span><br><span class="line">1. ScrollState==SCROLL_STATE_TOUCH_SCROLL（我们手指触摸屏幕，拖动ListView滑动） 时，我们和往常一样创建加载任务，并且显示图片，我们定义为普通加载模式。</span><br><span class="line">2. ScrollState==SCROLL_STATE_FLING （ListView在滑动，但是我们手指已经离开了屏幕，ListView出去 Fling 状态）时，图片停止加载。我们定义为延迟加载模式。</span><br><span class="line">3. ScrollState==SCROLL_STATE_IDEL，这时候ListView滑动停止，我们根据不同的加载模式，有不同的策略。</span><br><span class="line">4. 在普通加载模式下，图片逐张被加载显示出来。</span><br><span class="line">5. 在延迟加载模式下，LazyAdapter中会回调onLazyLoad 并带有两个参数：</span><br><span class="line">	1. firstVisibleItem</span><br><span class="line">	2. lastVisibleItem</span><br><span class="line"></span><br><span class="line">Adapter需要根据这两个变量来创建加载图片任务，并显示。我们需要继承LazyAdapter类。</span><br></pre></td></tr></table></figure></p>
<p>public abstract class LazyAdapter extends BaseAdapter {<br>    …<br>    public abstract void onLazyLoad(int first, int last);<br>    …<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LazyListView 中监听ScrollState是这样实现的：</span><br></pre></td></tr></table></figure></p>
<p>public class LazyListView extends ListView implements AbsListView.OnScrollListener {<br>    . . .<br>    private int mFirstCount;<br>    private int mVisibleCount;<br>    private LazyAdapter mLazyAdapter;<br>    @Override<br>    public void onScrollStateChanged(AbsListView view, int scrollState) {<br>        // TODO Auto-generated method stub<br>        if (scrollState == SCROLL_STATE_IDLE) {<br>            mLazyAdapter.onLazyLoad(mFirstCount, mVisibleCount + mFirstCount);<br>        }<br>    }<br>    @Override<br>    public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCount, int totalItemCount) {<br>        // TODO Auto-generated method stub<br>        mFirstCount = firstVisibleItem;<br>        mVisibleCount = visibleItemCount;<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">接着我们需要LazyAapater维持两个变量```isFirstLoad```和```mCurrentScrollState</span><br></pre></td></tr></table></figure></p>
<p>一个用来标记是否第一次加载，一个用来记录当前的ScrollState。在调用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">所以完整版的LazyAdapter是这样的：</span><br></pre></td></tr></table></figure></p>
<p>public abstract class LazyAdapter extends BaseAdapter {<br>    private boolean isFirstLoad;<br>    private int mCurrentScrollState;<br>    public void setFirstLoad(boolean isFirstLoad) {<br>        this.isFirstLoad = isFirstLoad;<br>    }<br>    public boolean isFirstLoad() {<br>        return isFirstLoad;<br>    }<br>    public void resetFirstLoad() {<br>        this.isFirstLoad = true;<br>    }<br>    public void setScrollState(int state) {<br>        this.mCurrentScrollState = state;<br>    }<br>    public boolean isTouchScroll() {<br>        return mCurrentScrollState == AbsListView.OnScrollListener.SCROLL_STATE_TOUCH_SCROLL;<br>    }<br>    @Override<br>    public void notifyDataSetChanged() {<br>        // TODO Auto-generated method stub<br>        resetFirstLoad();<br>        super.notifyDataSetChanged();<br>    }<br>    public abstract void onLazyLoad(int first, int last);<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">在LazyListView调用```setAdapter()```时，我们需要类型检测下，并且将LazyAdapter设为第一次加载状态.</span><br><span class="line">然后完成版的LazyListView是这样的:</span><br></pre></td></tr></table></figure></p>
<p>public class LazyListView extends ListView implements AbsListView.OnScrollListener {<br>    public LazyListView(Context context) {<br>        super(context);<br>        setOnScrollListener(this);<br>    }<br>    public LazyListView(Context context, AttributeSet attrs) {<br>        super(context, attrs);<br>        setOnScrollListener(this);<br>    }<br>    public LazyListView(Context context, AttributeSet attrs, int defStyle) {<br>        super(context, attrs, defStyle);<br>        setOnScrollListener(this);<br>    }<br>    private int mFirstCount;<br>    private int mVisibleCount;<br>    private LazyAdapter mLazyAdapter;<br>    @Override<br>    public void setAdapter(ListAdapter adapter) {<br>        if (adapter instanceof LazyAdapter) {<br>            mLazyAdapter = (LazyAdapter) adapter;<br>            mLazyAdapter.setFirstLoad(true);<br>            super.setAdapter(adapter);<br>        } else {<br>            throw new IllegalArgumentException(“The adapter must be LazyAdapter”);<br>        }<br>    }<br>    @Override<br>    public void onScrollStateChanged(AbsListView view, int scrollState) {<br>        // TODO Auto-generated method stub<br>        if (scrollState == SCROLL_STATE_IDLE) {<br>            mLazyAdapter.onLazyLoad(mFirstCount, mVisibleCount + mFirstCount);<br>        }<br>        if (mLazyAdapter.isFirstLoad()) {<br>            if (scrollState == SCROLL_STATE_TOUCH_SCROLL) {<br>                mLazyAdapter.setFirstLoad(false);<br>            }<br>        }<br>        mLazyAdapter.setScrollState(scrollState);<br>    }<br>    @Override<br>    public void onScroll(AbsListView view, int firstVisibleItem, int visibleItemCount, int totalItemCount) {<br>        mFirstCount = firstVisibleItem;<br>        mVisibleCount = visibleItemCount;<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">接着看看我们如何使用：</span><br></pre></td></tr></table></figure></p>
<p>public class DemoAdapter extends LazyAdapter {<br>    private SparseArray<lkimageview> mLazyImgs;<br>    @Override<br>    public void onLazyLoad(int first, int last) {<br>        //ToDo<br>        for (int i = first - 2; i &lt; last + 2; i++) {<br>            LKImageView img = mLazyImgs.get(i);<br>            if (img != null) {<br>                DisplayOptions options=…<br>                img.displayWithMemory(options);<br>            }<br>        }<br>        mLazyImgs.clear();<br>    }<br>    @Override<br>    public View getView(int position, View cv, ViewGroup viewGroup) {<br>          …<br>           Holder holder=…<br>           DisplayOptions options=…<br>           if(isFirstLoad()){<br>               holder.mImg.display(options);<br>           }else{<br>               if(isTouchScroll()){<br>                   holder.mImg.display(options);<br>               }else{<br>                   if(holder.mImg.tryDisplayWithMemory(options)){<br>                       mLazyImgs.append(position,holder.mImg);<br>                   }<br>               }<br>           }<br>           . . .<br>        return view;  //ToDo<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">LKImageView 是继承自ImageView类，并扩展了很多附加功能的控件，可以实现内存/磁盘缓存，显示功能==&gt;Link-ImageLoader</span><br><span class="line">现在我们只要知道：</span><br><span class="line"></span><br><span class="line">- ```public void display(DisplayOptions options);``` 异步加载图片的方法。</span><br><span class="line">- ```public boolean tryDisplayWithMemory(DisplayOptions options); ```尝试从内存中同步加载图片的方法</span><br><span class="line"></span><br><span class="line">在onLazyLoad()中 ```for (int i = first - 2; i &lt; last + 2; i++)</span><br></pre></td></tr></table></figure></lkimageview></p>
<p>分别-2和+2，可以做到不仅仅加载当前屏幕的可见范围，还可以多加载几个，不做调整也是没有关系的。</p>
<p><strong>并且<code>mLazyImgs.clear()</code>在结束是必须要调用的，不然会有问题。</strong></p>
<p>现在就去尝试下吧，你可以下载我们的这个应用</p>
<p><img src="https://lh4.ggpht.com/EUP4NTyHIMdWZsMgYX5w2kgIE3e3JE5Ud_Yx7tkeYOj8AALgSS2TUYoW92V-dQvVyVM=w124" height="50"><a href="https://play.google.com/store/apps/details?id=com.huaban.wallpaper&amp;feature=search_result#?t=W251bGwsMSwxLDEsImNvbS5odWFiYW4ud2FsbHBhcGVyIl0." target="_blank" rel="noopener">壁纸控</a> ，里面使用了这套加载策略。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/14/2013-05-14-lazylistview/" data-id="cjdnn3tle000krpfyenhqjl5u" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-05-14-lifealgorithm" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/14/2013-05-14-lifealgorithm/">程序算法与人生选择</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/14/2013-05-14-lifealgorithm/">
            <time datetime="2013-05-13T16:00:00.000Z" itemprop="datePublished">2013-05-14</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>每年一到要找工作的时候，我就能收到很多人给我发来的邮件，总是问我怎么选择他们的offer，去腾讯还是去豆瓣，去外企还是去国内的企业，去创业还是去考研，来北京还是回老家，该不该去创新工场？该不该去thoughtworks？……等等，等等。今年从7月份到现在，我收到并回复了60多封这样的邮件。我更多帮他们整理思路，帮他们明白自己最想要的是什么。（注：我以后不再回复类似的邮件了）。</p>
<p>我深深地发现，对于我国这样从小被父母和老师安排各种事情长大的人，当有一天，父母和老师都跟不上的时候，我们几乎完全不知道怎么去做选择。而我最近也离开了亚马逊，换了一个工作。又正值年底，就像去年的那篇<a href="http://coolshell.cn/articles/6142.html" target="_blank" rel="noopener">《三个故事和三个问题》</a>一样，让我想到写一篇这样的文章。</p>
<p>##几个例子</p>
<p>当我们在面对各种对选择的影响因子的时候，如：城市，公司规模，公司性质，薪水，项目，户口，技术，方向，眼界…… 你总会发现，你会在几个公司中纠结一些东西，举几个例子：</p>
<ul>
<li>某网友和我说，他们去上海腾讯，因为腾讯的规模很大，但却发现薪水待遇没有豆瓣高（低的还不是一点），如果以后要换工作的话，起薪点直接关系到了以后的高工资。我说那就去豆瓣吧，他说豆瓣在北京，污染那么严重，又没有户口，生存环境不好。我说去腾讯吧，他说腾讯最近组织调整，不稳定。我说那就去豆瓣吧，慢公司，发展很稳当。他说，豆瓣的盈利不清楚，而且用Python，自己不喜欢。我说，那就去腾讯吧，……</li>
<li><p>还有一网友和我说，他想回老家，因为老家的人脉关系比较好，能混得好。但又想留在大城市，因为大城市可以开眼界。</p>
</li>
<li><p>另一网友和我说，他想进外企，练练英语，开开眼界，但是又怕在外企里当个螺丝钉，想法得不到实施。朋友拉他去创业，觉得创业挺好的，锻炼大，但是朋友做的那个不知道能不能做好。</p>
</li>
<li>还有一网友在创新工场的某团队和考研之间抉择，不知道去创新工场行不行，觉得那个项目一般，但是感觉那个团队挺有激情的，另一方面觉得自己的学历还不够，读个研应该能找到更好的工作。</li>
<li>还有一些朋友问题我应该学什么技术？不应该学什么技术？或是怎么学会学得最快，技术的路径应该是什么？有的说只做后端不做前端，有的说，只做算法研究，不做工程，等等，等等。因为他们觉得人生有限，术业有专攻。</li>
<li>等等，等等……</li>
</ul>
<p>我个人觉得，如果是非计算机科班出生的人不会做选择，不知道怎么走也罢了，但是我们计算机科班出生的人是学过算法的，<strong>懂算法的人应该是知道怎么做选择的。</strong></p>
<p>##排序算法</p>
<p>你不可能要所有的东西，所以你只能要你最重要的东西，你要知道什么东西最重要，你就需要对你心内的那些欲望和抱负有清楚的认识，不然，你就会在纠结中度过。</p>
<p>所以，在选择中纠结的人有必要参考一下排序算法。</p>
<ul>
<li>首先，你最需要参考的就是“冒泡排序”——这种算法的思路就是每次冒泡出一个最大的数。所以，你有必要问问你自己，面对那些影响你选择的因子，如果你只能要一个的话，你会要哪个？而剩下的都可以放弃。于是，当你把最大的数，一个一个冒泡出来的时候，并用这个决策因子来过滤选项的时候，你就能比较容易地知道知道你应该选什么了。<strong>这个算法告诉我们，人的杂念越少，就越容易做出选择。</strong></li>
<li>好吧，可能你已茫然到了怎么比较两个决策因子的大小，比如：你分不清楚，工资&gt;业务前景吗？业务前景&gt;能力提升吗？所以你完全没有办法进行冒泡法。那你，你不妨参考一个“快速排序”的思路——这个算法告诉我们，我们一开始并不需要找到最大的数，我们只需要把你价值观中的某个标准拿出来，然后，把可以满足这个价值的放到右边，不能的放到左边去。比如，你的标准是：工资大于5000元&amp;&amp;业务前景长于3年的公司，你可以用这个标准来过滤你的选项。然后，你可以再调整这个标准再继续递归下去。<strong>这个算法告诉我们，我们的选择标准越清晰，我们就越容易做出选择。</strong></li>
</ul>
<p>这是排序算法中最经典的两个算法了，面试必考。相信你已烂熟于心中了。所以，我觉得你把这个算法应用于你的人生选择也应该不是什么问题。关于在于，你是否知道自己想要的是什么？</p>
<p>排序算法的核心思想就是，让你帮助你认清自己最需要的是什么，认清自己最想要的是什么，然后根据这个去做选择。</p>
<p>##贪婪算法</p>
<p>所谓贪婪算法，是一种在每一步选择中都采取在当前状态下最好或最优（即最有利）的选择（注意：是当前状态下），从而希望导致结果是最好或最优的算法。贪婪算法最经典的一个例子就是哈夫曼编码。</p>
<p>对于人类来说，一般人在行为处事的时候都会使用到贪婪算法，</p>
<ul>
<li>比如在找零钱的时候，如果要找补36元，我们一般会按这样的顺序找钱：20元，10元，5元，1元。</li>
<li>或者我们在过十字路口的时候，要从到对角线的那个街区时，我们也会使用贪婪算法——哪边的绿灯先亮了我们就先过到那边去，然后再转身90度等红灯再过街。</li>
</ul>
<p>这样的例子有很多。对于选择中，大多数人都会选用贪婪算法，因为这是一个比较简单的算法，未来太复杂了，只能走一步看一步，在当前的状况下做出最利于自己的判断和选择即可。</p>
<p>有的人会贪婪薪水，有的人会贪婪做的项目，有的人会贪婪业务，有的人会贪婪职位，有的人会贪婪自己的兴趣……这些都没什么问题。贪婪算法并没有错，虽然不是全局最优解，但其可以让你找到局部最优解或是次优解。其实，有次优解也不错了。<strong>贪婪算法基本上是一种急功近利的算法，但是并不代表这种算法不好，如果贪婪的是一种长远和持续，又未尝不可呢？。</strong></p>
<p>##动态规划</p>
<p>但是我们知道，对于大部分的问题，贪婪法通常都不能找出最优解，因为他们一般没有测试所有可能的解。<strong>因为贪婪算法是一种短视的行为，只会跟据当前的形式做判断，也就是过早做决定，因而没法达到最佳解。</strong></p>
<p>动态规划和贪婪算法的最大不同是，贪婪算法做出选择，不能回退。动态规划则会保存以前的运算结果，并根据以前的结果对当前进行选择，有回退功能。</p>
<p>动态规划算法至少告诉我们两个事：</p>
<ol>
<li><p><strong>承前启后非常重要</strong>，当你准备去做遍历的时候，你的上次的经历不但能开启你以后的经历，而且还能为后面的经历所用。你的每一步都没有浪费。</p>
</li>
<li><p><strong>是否可以回退也很重要。</strong>这意思是——如果你面前有两个选择，一个是A公司一个是B公司，如果今天你错失了B公司，那到你明天还能不能找回来？</p>
</li>
</ol>
<p>比如说：你有两个offer，一个是Yahoo，一个是Baidu，上述的第一点会让我们思考，Yahoo和Baidu谁能给我们开启更大的平台？上述的第二点告诉我们，是进入Yahoo后如果没有选好，是否还能回退到Baidu公司？还是进入Baidu公司后能容易回退到Yahoo公司？</p>
<p>##Dijkstra最短路径</p>
<p>最短路径是一个Greedy + DP的算法。相当经典。这个算法的大意如下：</p>
<ol>
<li><p>在初始化的时候，所有的结点都和我是无穷大，默认是达不到的。</p>
</li>
<li><p>从离自己最近的结点开始贪婪。</p>
</li>
<li><p>走过去，看看又能到达什么样的结点，计算并更新到所有目标点的距离。</p>
</li>
<li><p>再贪婪与原点最短的结点，如此反复。</p>
</li>
</ol>
<p>这个算法给我们带来了一些这样的启示：</p>
<p>有朋友和我说过他想成为一个架构师，或是某技术领域的专家，并会踏踏实实的向这个目标前进，永不放弃。我还是鼓励了他，但我也告诉他了这个著名的算法，我说，这个算法告诉你，架构师或某领域的专家对你来说目前的距离是无穷大，他们放在心中，先看看你能够得着的东西。<strong>所谓踏实，并不是踏踏实实追求你的目标，而是踏踏实实把你够得着看得见的就在身边的东西干好。</strong>我还记得我刚参加工作，从老家出来的时候，从来没有想过要成为一个技术牛人，也从来没有想过我的博客会那么的有影响力，在做自己力所能及，看得见摸得着的事情，我就看见什么技术就学什么，学着学着就知道怎么学更轻松，怎么学更扎实，这也许就是我的最短路径。<br>有很多朋友问我要不要学C++，或是问我学Python还是学Ruby，是不是不用学前端，等等。这些朋友告诉我，他们不可能学习多个语言，学了不用也就忘了，而且术业有专攻。这并没有什么不对的，只是我个人觉得，学习一个东西没有必要只有两种状态，一种是不学，另一种是精通。了解一个技术其实花不了多少时间，我学C++的目的其实是为了更懂Java，学TCP/IP协议其实是为了更懂Socket编程，很多东西都是连通和相辅相成的，学好了C/C++/Unix/TCP等这些基础技术后，我发现到达别的技术路径一下缩短了（这就是为什么<a href="http://coolshell.cn/articles/8489.html" target="_blank" rel="noopener">我用两天时间就可以了解Go语言的原因</a>）。这就好像这个算法一样，算法效率不高，也许达到你的目标，你在一开始花了很长时间，遍历了很多地方，但是，这也许这就是你的最短路径。</p>
<p>##算法就是Trade-Off</p>
<p>你根本没有办法能得到所有你想得到的东西，<strong>任何的选择都意味着放弃——当你要去获得一个东西的时候，你总是需要放弃一些东西。人生本来就是一个跷跷板，一头上，另一头必然下。</strong>这和我们做软件设计或算法设计一样，用时间换空间，用空间换时间，还有CAP理论，总是有很多的Trade-Off，正如这个短语的原意一样——<strong>你总是要用某种东西去交易某种东西。</strong></p>
<p>我们都在用某种东西在交易我们的未来，有的人用自己的努力，有的人用自己的思考，有的人用自己的年轻，有的人用自己的自由，有的人用自己的价值观，有的人用自己的道德…… …… 有的人在交换金钱，有的人在交换眼界，有的人在交换经历，有的人在交换地位，有的人在交换能力，有的人在交换自由，有的人在交换兴趣，有的人在交换虚荣心，在交换安逸享乐…… ……</p>
<p><strong>每个人有每个人的算法，每个算法都有每个算法的purpose，就算大家在用同样的算法，但是每个人算法中的那些变量、开关和条件都不一样，得到的结果也不一样。我们就是生活在Matrix里的一段程序，我们每个人的算法决定着我们每个人的选择，我们的选择决定了我们的人生。</strong></p>
<hr>
<p><a href="http://coolshell.cn/articles/8790.html" target="_blank" rel="noopener">原文连接</a></p>
<p>非常喜欢这篇文章就转过来，时时督促自己！</p>
<p>###我的算法是什么？我的目标是什么？<br><img src="http://pic.yupoo.com/wsyanligang_v/CRnsVx3l/3Zin9.jpg" alt="car "></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/14/2013-05-14-lifealgorithm/" data-id="cjdnn3tld000jrpfysn8m3vv1" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/">&laquo; Anterior</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Siguiente  &raquo;</a>
    </nav>
</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">Recientes</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/02/15/2017年年终总结/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/02/15/2017年年终总结/" class="title">2017年年终总结</a></p>
                            <p class="item-date"><time datetime="2018-02-14T21:59:27.000Z" itemprop="datePublished">2018-02-15</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/02/15/hello-world/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/02/15/hello-world/" class="title">Hello World</a></p>
                            <p class="item-date"><time datetime="2018-02-14T20:49:39.472Z" itemprop="datePublished">2018-02-15</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2013/11/28/2013-11-28-picasso/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
                            <p class="item-title"><a href="/2013/11/28/2013-11-28-picasso/" class="title">Android Picasso-强大的图片下载缓存类库</a></p>
                            <p class="item-date"><time datetime="2013-11-27T16:00:00.000Z" itemprop="datePublished">2013-11-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2013/10/30/2013-10-30-display-gif/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
                            <p class="item-title"><a href="/2013/10/30/2013-10-30-display-gif/" class="title">Android中显示动画的GIF-Movie类解决方案</a></p>
                            <p class="item-date"><time datetime="2013-10-29T16:00:00.000Z" itemprop="datePublished">2013-10-30</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2013/08/01/2013-08-01-dynamic_load/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
                            <p class="item-title"><a href="/2013/08/01/2013-08-01-dynamic_load/" class="title">Custom Class Loading in Dalvik (译)</a></p>
                            <p class="item-date"><time datetime="2013-07-31T16:00:00.000Z" itemprop="datePublished">2013-08-01</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">Categorias</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">25</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">Archivos</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">Etiquetas</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/work/">work</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">Nube de etiquetas</h3>
        <div class="widget tagcloud">
            <a href="/tags/work/" style="font-size: 10px;">work</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">Links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2018 Alin<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        


    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>