<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Alin Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="做成一件有意义的事">
<meta property="og:type" content="website">
<meta property="og:title" content="Alin Blog">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Alin Blog">
<meta property="og:description" content="做成一件有意义的事">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Alin Blog">
<meta name="twitter:description" content="做成一件有意义的事">
    

    
        <link rel="alternate" href="/" title="Alin Blog" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Alin Blog</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Buscar" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Entradas',
            PAGES: 'Pages',
            CATEGORIES: 'Categorias',
            TAGS: 'Etiquetas',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Buscar" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/avatar.png" />
            <h2 id="name">阿霖</h2>
            <h3 id="title">产品经理&amp;程序员</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Hangzhou, China</span>
            <a id="follow" target="_blank" href="https://weibo.com/nvolume">SEGUIR</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                27
                <span>Entradas</span>
            </div>
            <div class="article-info-block">
                1
                <span>Etiqueta</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/linkyan" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-2013-05-13-android-universal-image-loader" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/13/2013-05-13-android-universal-image-loader/">介绍开源项目 Android-Universal-Image-Loader -Part 1</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/13/2013-05-13-android-universal-image-loader/">
            <time datetime="2013-05-12T16:00:00.000Z" itemprop="datePublished">2013-05-13</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>Github地址：<a href="https://github.com/nostra13/Android-Universal-Image-Loader" target="_blank" rel="noopener">Android-Universal-Image-Loader</a> 万能的图片加载器!<br>作者：<a href="https://github.com/nostra13" target="_blank" rel="noopener">nostra13</a></p>
<p>废话不多开始介绍</p>
<p>This project aims to provide a reusable instrument for asynchronous image loading, caching and displaying. It is originally based on Fedor Vlasov’s project and has been vastly refactored and improved since then.</p>
<p>作者说他也是<a href="https://github.com/thest1/LazyList" target="_blank" rel="noopener">Fedor Vlasov’s project</a>这个项目改写过来的，做到对图片的异步加载，缓存和显示。</p>
<p>##特性</p>
<ul>
<li>多线程图片加载</li>
<li>尽可能多的配置选项（线程池，加载器，解析器，内存/磁盘缓存，显示参数等等）</li>
<li>图片可以缓存在内存中，或者设备文件目录下，或者SD卡中</li>
<li>可以监听加载进度</li>
<li>可以自定义显示每一张图片时都带不同参数</li>
<li>支持Widget</li>
</ul>
<h2 id="Quick-Setup"><a href="#Quick-Setup" class="headerlink" title="Quick Setup"></a>Quick Setup</h2><h3 id="1-Include-library"><a href="#1-Include-library" class="headerlink" title="1.Include library"></a>1.Include library</h3><p><a href="https://github.com/nostra13/Android-Universal-Image-Loader/raw/master/downloads/universal-image-loader-1.8.4-with-sources.jar" target="_blank" rel="noopener">下载连接 JAR</a></p>
<h3 id="2-Android-Manifest"><a href="#2-Android-Manifest" class="headerlink" title="2.Android Manifest"></a>2.Android Manifest</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest&gt;</span><br><span class="line">    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</span><br><span class="line">    &lt;!-- Include next permission if you want to allow UIL to cache images on SD card --&gt;</span><br><span class="line">    &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;application android:name=&quot;MyApplication&quot;&gt;</span><br><span class="line">        ...</span><br><span class="line">    &lt;/application&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-Application-class"><a href="#3-Application-class" class="headerlink" title="3. Application class"></a>3. Application class</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class MyApplication extends Application &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        super.onCreate();</span><br><span class="line">        // Create global configuration and initialize ImageLoader with this configuration</span><br><span class="line">        ImageLoaderConfiguration config = new ImageLoaderConfiguration.Builder(getApplicationContext())</span><br><span class="line">            ...</span><br><span class="line">            .build();</span><br><span class="line">        ImageLoader.getInstance().init(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Configuration-and-Display-Options"><a href="#Configuration-and-Display-Options" class="headerlink" title="Configuration and Display Options"></a>Configuration and Display Options</h2><ul>
<li>Configuration(ImageLoaderConfiguration) 是相对于整个应用的配置</li>
<li>Display Options(DisplayImageOptions)是针对每一个显示图片任务所提供的参数(ImageLoader.displayImage(…)).</li>
</ul>
<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><p>所有的选项都是可选的，只选择你真正想制定的去配置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// DON&apos;T COPY THIS CODE TO YOUR PROJECT! This is just example of ALL options using.</span><br><span class="line">File cacheDir = StorageUtils.getCacheDirectory(context);</span><br><span class="line">ImageLoaderConfiguration config = new ImageLoaderConfiguration.Builder(context)</span><br><span class="line">		//如果图片尺寸大于了这个参数，那么就会这按照这个参数对图片大小进行限制并缓存</span><br><span class="line">        .memoryCacheExtraOptions(480, 800) // default=device screen dimensions</span><br><span class="line">        .discCacheExtraOptions(480, 800, CompressFormat.JPEG, 75)</span><br><span class="line">        .taskExecutor(AsyncTask.THREAD_POOL_EXECUTOR)</span><br><span class="line">        .taskExecutorForCachedImages(AsyncTask.THREAD_POOL_EXECUTOR)</span><br><span class="line">        .threadPoolSize(3) // default</span><br><span class="line">        .threadPriority(Thread.NORM_PRIORITY - 1) // default</span><br><span class="line">        .tasksProcessingOrder(QueueProcessingType.FIFO) // default</span><br><span class="line">        .denyCacheImageMultipleSizesInMemory()</span><br><span class="line">        .memoryCache(new LruMemoryCache(2 * 1024 * 1024))</span><br><span class="line">        .memoryCacheSize(2 * 1024 * 1024)</span><br><span class="line">        .discCache(new UnlimitedDiscCache(cacheDir)) // default</span><br><span class="line">        .discCacheSize(50 * 1024 * 1024)</span><br><span class="line">        .discCacheFileCount(100)</span><br><span class="line">        .discCacheFileNameGenerator(new HashCodeFileNameGenerator()) // default</span><br><span class="line">        .imageDownloader(new BaseImageDownloader(context)) // default</span><br><span class="line">        .imageDecoder(new BaseImageDecoder()) // default</span><br><span class="line">        .defaultDisplayImageOptions(DisplayImageOptions.createSimple()) // default</span><br><span class="line">        .enableLogging()</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>
<p>参数主要包括了这么几类配置</p>
<ol>
<li>线程池配置</li>
<li>内存缓存配置</li>
<li>磁盘缓存配置</li>
<li>使用哪个图片下载器</li>
<li>使用哪个图片解析器<br>实际上，不做任何配置也是ImageLoader也是可以使用的。<br>插一句，配置选项的确够丰富，但有多是没有必要的。</li>
</ol>
<h3 id="Display-Options"><a href="#Display-Options" class="headerlink" title="Display Options"></a>Display Options</h3><p>显示参数可以分别被每一个显示任务调用(ImageLoader.displayImage(…))</p>
<p>Note:<strong>如果没有调用ImageLoader.displayImage(…),那么将使用配置选项中的默认显示参数(ImageLoaderConfiguration.defaultDisplayImageOptions(…))</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DisplayImageOptions options = new DisplayImageOptions.Builder()</span><br><span class="line">        .showStubImage(R.drawable.ic_stub)  // 在显示真正的图片前，会加载这个资源</span><br><span class="line">        .showImageForEmptyUri(R.drawable.ic_empty) //空的Url时</span><br><span class="line">        .showImageOnFail(R.drawable.ic_error)</span><br><span class="line">        .resetViewBeforeLoading() //</span><br><span class="line">        .delayBeforeLoading(1000)     // 延长1000ms 加载图片  （想不出来用在什么场景下）</span><br><span class="line">        .cacheInMemory()              </span><br><span class="line">        .cacheOnDisc()               </span><br><span class="line">        .preProcessor(...)            </span><br><span class="line">        .postProcessor(...)           </span><br><span class="line">        .extraForDownloader(...)      //可以向加载器携带一些参数</span><br><span class="line">        .imageScaleType(ImageScaleType.IN_SAMPLE_POWER_OF_2) // default  </span><br><span class="line">        .bitmapConfig(Bitmap.Config.ARGB_8888) // default</span><br><span class="line">        .decodingOptions(...)</span><br><span class="line">        .displayer(new SimpleBitmapDisplayer()) // default</span><br><span class="line">        .handler(new Handler()) // default</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h3 id="可接收的URL"><a href="#可接收的URL" class="headerlink" title="可接收的URL"></a>可接收的URL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String imageUri = &quot;http://site.com/image.png&quot;; // from Web</span><br><span class="line">String imageUri = &quot;file:///mnt/sdcard/image.png&quot;; // from SD card</span><br><span class="line">String imageUri = &quot;content://media/external/audio/albumart/13&quot;; // from content provider</span><br><span class="line">String imageUri = &quot;assets://image.png&quot;; // from assets</span><br><span class="line">String imageUri = &quot;drawable://&quot; + R.drawable.image; // from drawables (only imag</span><br><span class="line">es, non-9patch)</span><br></pre></td></tr></table></figure>
<p>###例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// Load image, decode it to Bitmap and display Bitmap in ImageView</span><br><span class="line">imageLoader.displayImage(imageUri, imageView);</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// Load image, decode it to Bitmap and return Bitmap to callback</span><br><span class="line">imageLoader.loadImage(imageUri, new SimpleImageLoadingListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onLoadingComplete(String imageUri, View view, Bitmap loadedImage) &#123;</span><br><span class="line">        // Do whatever you want with Bitmap</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="完整版"><a href="#完整版" class="headerlink" title="完整版"></a>完整版</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// Load image, decode it to Bitmap and display Bitmap in ImageView</span><br><span class="line">imageLoader.displayImage(imageUri, imageView, displayOptions, new ImageLoadingListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onLoadingStarted(String imageUri, View view) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void onLoadingFailed(String imageUri, View view, FailReason failReason) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void onLoadingComplete(String imageUri, View view, Bitmap loadedImage) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void onLoadingCancelled(String imageUri, View view) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ImageSize targetSize = new ImageSize(120, 80); // result Bitmap will be fit to this size</span><br><span class="line">imageLoader.loadImage(imageUri, targetSize, displayOptions, new SimpleImageLoadingListener() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onLoadingComplete(String imageUri, View view, Bitmap loadedImage) &#123;</span><br><span class="line">        // Do whatever you want with Bitmap</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>###ImageLoader Helpers<br>一些可能会用到的帮助类和方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ImageLoader |</span><br><span class="line">            | - getMemoryCache()</span><br><span class="line">            | - clearMemoryCache()</span><br><span class="line">            | - getDiscCache()</span><br><span class="line">            | - clearDiscCache()</span><br><span class="line">            | - denyNetworkDownloads(boolean)</span><br><span class="line">            | - handleSlowNetwork(boolean)</span><br><span class="line">            | - pause()</span><br><span class="line">            | - resume()</span><br><span class="line">            | - stop()</span><br><span class="line">            | - destroy()</span><br><span class="line">            | - getLoadingUriForView(ImageView)</span><br><span class="line">            | - cancelDisplayTask(ImageView)</span><br><span class="line">MemoryCacheUtil |</span><br><span class="line">                | - findCachedBitmapsForImageUri(...)</span><br><span class="line">                | - findCacheKeysForImageUri(...)</span><br><span class="line">                | - removeFromCache(...)</span><br><span class="line">DiscCacheUtil |</span><br><span class="line">              | - findInCache(...)</span><br><span class="line">              | - removeFromCache(...)</span><br><span class="line">StorageUtils |</span><br><span class="line">             | - getCacheDirectory(Context)</span><br><span class="line">             | - getIndividualCacheDirectory(Context)</span><br><span class="line">             | - getOwnCacheDirectory(Context, String)</span><br><span class="line">PauseOnScrollListener</span><br></pre></td></tr></table></figure>
<h2 id="Useful-Info"><a href="#Useful-Info" class="headerlink" title="Useful Info"></a>Useful Info</h2><p>1.使用默认值时缓存无效。如果你想要加载图片的时候使用内存/磁盘中的缓存，那么你应该这样设置DisplayImageOptions:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// Create default options which will be used for every</span><br><span class="line">//  displayImage(...) call if no options will be passed to this method</span><br><span class="line">DisplayImageOptions defaultOptions = new DisplayImageOptions.Builder()</span><br><span class="line">        ...</span><br><span class="line">        .cacheInMemory()</span><br><span class="line">        .cacheOnDisc()</span><br><span class="line">        ...</span><br><span class="line">        .build();</span><br><span class="line">ImageLoaderConfiguration config = new ImageLoaderConfiguration.Builder(getApplicationContext())</span><br><span class="line">        ...</span><br><span class="line">        .defaultDisplayImageOptions(defaultOptions)</span><br><span class="line">        ...</span><br><span class="line">        .build();</span><br><span class="line">ImageLoader.getInstance().init(config); // Do it on Application start</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// Then later, when you want to display image</span><br><span class="line">ImageLoader.getInstance().displayImage(imageUrl, imageView); // Default options will be used</span><br></pre></td></tr></table></figure>
<p>或者这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DisplayImageOptions options = new DisplayImageOptions.Builder()</span><br><span class="line">        ...</span><br><span class="line">        .cacheInMemory()</span><br><span class="line">        .cacheOnDisc()</span><br><span class="line">        ...</span><br><span class="line">        .build();</span><br><span class="line">ImageLoader.getInstance().displayImage(imageUrl, imageView, options); // Incoming options will be used</span><br></pre></td></tr></table></figure>
<p>2.如果你允许缓存在磁盘中，那么UIL将尝试缓存到(/sdcard/Android/data/[package_name]/cache)路径中。如果外部存储不可用的话，图片将缓存在设备文件系统下。为了支持在外部存储(SD card）中缓存,那么应该在AndroidManifest.xml中加上这个权限:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>3.UIL如果知道Bitmap应该有多大的尺寸放在确定了点ImageView中？它搜索以下几个定义的参数：</p>
<ul>
<li>从ImageView测量准确的高和宽获得</li>
<li>从android:layout_width 和 android:layout_height 参数获得</li>
<li>从 android:maxWidth 和/或者 android:maxHeight 参数获得</li>
<li>从在configuration定义的maximun width 和/或者 height参数获得</li>
<li>从设备屏幕 width 和/或者 height 获得</li>
</ul>
<p>If you often got OutOfMemoryError in your app using Universal Image Loader then try next (all of them or several):</p>
<ul>
<li>Reduce thread pool size in configuration (.threadPoolSize(…)). 1 - 5 is recommended.</li>
<li>Use .bitmapConfig(Bitmap.Config.RGB_565) in display options. Bitmaps in RGB_565 consume 2 times less memory than in ARGB_8888.</li>
<li>Use .memoryCache(new WeakMemoryCache()) in configuration or disable caching in memory at all in display options (don’t call .cacheInMemory()).</li>
<li>Use .imageScaleType(ImageScaleType.IN_SAMPLE_INT) in display options. Or try .imageScaleType(ImageScaleType.EXACTLY).</li>
<li>Avoid using RoundedBitmapDisplayer. It creates new Bitmap object with ARGB_8888 config for displaying during work.</li>
</ul>
<p>5.For memory cache configuration (ImageLoaderConfiguration.memoryCache(…)) you can use already prepared implementations.</p>
<ul>
<li>Cache using only strong references:<br>LruMemoryCache (Least recently used bitmap is deleted when cache size limit is exceeded) - Used by default for API &gt;= 9</li>
<li>Caches using weak and strong references:<br>UsingFreqLimitedMemoryCache (Least frequently used bitmap is deleted when cache size limit is exceeded)<br>LRULimitedMemoryCache (Least recently used bitmap is deleted when cache size limit is exceeded) - Used by default for API &lt; 9<br>FIFOLimitedMemoryCache (FIFO rule is used for deletion when cache size limit is exceeded)<br>LargestLimitedMemoryCache (The largest bitmap is deleted when cache size limit is exceeded)<br>LimitedAgeMemoryCache (Decorator. Cached object is deleted when its age exceeds defined value)</li>
<li>Cache using only weak references:<br>WeakMemoryCache (Unlimited cache)</li>
</ul>
<p>6.For disc cache configuration (ImageLoaderConfiguration.discCache(…)) you can use already prepared implementations:</p>
<ul>
<li>UnlimitedDiscCache (The fastest cache, doesn’t limit cache size) - Used by default</li>
<li>TotalSizeLimitedDiscCache (Cache limited by total cache size. If cache size exceeds specified limit then file with the most oldest last usage date will be deleted)</li>
<li>FileCountLimitedDiscCache (Cache limited by file count. If file count in cache directory exceeds specified limit then file with the most oldest last usage date will be deleted. Use it if your cached files are of about the same size.)</li>
<li>LimitedAgeDiscCache (Size-unlimited cache with limited files’ lifetime. If age of cached file exceeds defined limit then it will be deleted from cache.)<br><strong>NOTE: UnlimitedDiscCache is 30%-faster than other limited disc cache implementations.</strong></li>
</ul>
<p>7.To display bitmap (DisplayImageOptions.displayer(…)) you can use already prepared implementations:</p>
<ul>
<li>RoundedBitmapDisplayer (Displays bitmap with rounded corners)</li>
<li>FadeInBitmapDisplayer (Displays image with “fade in” animation)</li>
</ul>
<p>8.To avoid list (grid, …) scrolling lags you can use PauseOnScrollListener:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">boolean pauseOnScroll = false; // or true</span><br><span class="line">boolean pauseOnFling = true; // or false</span><br><span class="line">PauseOnScrollListener listener = new PauseOnScrollListener(imageLoader, pauseOnScroll, pauseOnFling);</span><br><span class="line">listView.setOnScrollListener(listener);</span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/13/2013-05-13-android-universal-image-loader/" data-id="cjdnn3tkl0008rpfydn76qa5q" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-05-11-custom-adapterview" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/11/2013-05-11-custom-adapterview/">创建属于你自己的3D ListView - Part 1(译)</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/11/2013-05-11-custom-adapterview/">
            <time datetime="2013-05-10T16:00:00.000Z" itemprop="datePublished">2013-05-11</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>原文连接 <a href="http://developer.sonymobile.com/2010/05/20/android-tutorial-making-your-own-3d-list-part-1/" target="_blank" rel="noopener">Making your own 3D list - Part 1</a></p>
<p>本文是教你如何在安卓应用中做出很酷效果的ListView的教材第一章，我叫Anders Ericson，主要从事UI工作，在Timescape应用中有个就是我做的，你可以在Xperia X10 mini 和 Xperia X10 mini pro中找到.当用户尝试使用一个App时，UI是他们第一个关注的东西,所以我决定做一个教材，使得其他任何安卓开发者可以创建属于他们自己的ListView,类似与在Timescape中的3D感觉和物理特性(dynamics).</p>
<p>在教材的第一章，我们将创建一个很基础的list，然后在接下去的两章中，越来越多的功能和特性将添加进来。我同时也会教你如何使用list的基本构造，然后改变它使得无论如何工作的都使你的应用做到最好。下面那个链接是第一章的源码，已经为你准备好构建在如Eclipse这样的IDE中。同时不要忘了下载Sony Ericsson Tutorials 应用从Android Market中，你可以尝试使用同样的应用在教材的每一步。我很期待看到你的评论和问题。</p>
<p>Android中标准的ListView已经支持了很多东西，并且包括了绝大多数的你可以想到的用户事件。但是listview看起来太平淡了，当你想继承它并且做很多事情时，都发现做不到，然后无疾而终。标准ListView的另一个缺点是缺乏好的物理特性（和改变它的能力）。因此，如果你要你的UI看起来不那么普通的话，你要做的仅仅是实现你自己的View.</p>
<p>因为在一篇文章中写完会有太多的代码，所以我准备分为3部分。第一部分（就是这章）先创建一个基本的List，有太多的东西要去包括，但我想让我们更关注它们在后面几章.第二章，我们将看到listview的外貌改变和一些类3D图像算法。最后一章，我们将改变list的行为并且添加一些物理动力学进去，一些非常能提升外观和感觉的东西。</p>
<p>虽然这里用到的技术和在X10 Mini上用到的一样，当这篇教材的目的不是仅仅拷贝一个看起来很特殊的list，而是教你实现自己的listview。我很确定你肯定有很多关于你的listview该看起来怎么样，它的行为和它用来干嘛的主意。</p>
<h3 id="Hello-AdapterView"><a href="#Hello-AdapterView" class="headerlink" title="Hello AdapterView"></a>Hello AdapterView</h3><p>当我们瞄准一个list（能显示其他view）,我们需要继承ViewGroup,更合适的是AdapterView。（原因，或者更多的原因我们不从AbsListView继承，是因为它不允许我们在list上做有活力的效果）。那么，让我们从开始建立安卓项目并且创建一个继承自AdapterView<adapter> 的 MyListView 开始吧，AdapterView有四个抽象函数我们需要去实现:</adapter></p>
<ul>
<li>getAdapter()</li>
<li>setAdapter()</li>
<li>getSelectedView()</li>
<li>setSelection()</li>
</ul>
<p>getAdapter()和setAdapter()直接实现，其他两个现在先仅仅抛出异常.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class MyListView extends AdapterView &#123;</span><br><span class="line">    /** The adapter with all the data */</span><br><span class="line">    private Adapter mAdapter;</span><br><span class="line">    public MyListView(Context context, AttributeSet attrs) &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void setAdapter(Adapter adapter) &#123;</span><br><span class="line">        mAdapter = adapter;</span><br><span class="line">        removeAllViewsInLayout();</span><br><span class="line">        requestLayout();</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public Adapter getAdapter() &#123;</span><br><span class="line">        return mAdapter;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void setSelection(int position) &#123;</span><br><span class="line">        throw new UnsupportedOperationException(&quot;Not supported&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public View getSelectedView() &#123;</span><br><span class="line">        throw new UnsupportedOperationException(&quot;Not supported&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里唯一值得注意的是setAdapter方法。当我们获得一个新的Adapter我们移除之前所有的视图，然后请求一个布局，并且按照adapter放置视图。如果我们现在创建一个activity和带有假数据的adapter，然后使用新视图，我们将得不到任何东西，在屏幕上。这是因为如果我们要在屏幕上得到一些东西，我们需要重写onLayout()方法。</p>
<h4 id="显示我们的第一个视图"><a href="#显示我们的第一个视图" class="headerlink" title="显示我们的第一个视图"></a>显示我们的第一个视图</h4><p>在<a href="http://developer.android.com/reference/android/view/View.html#onLayout(boolean,%20int,%20int,%20int,%20int" target="_blank" rel="noopener">onLayout( )</a> )中，我们从adpater中获取视图，并且添加他们作为一个子视图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;</span><br><span class="line">    super.onLayout(changed, left, top, right, bottom);</span><br><span class="line">    // if we don&apos;t have an adapter, we don&apos;t need to do anything</span><br><span class="line">    if (mAdapter == null) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (getChildCount() == 0) &#123;</span><br><span class="line">        int position = 0;</span><br><span class="line">        int bottomEdge = 0;</span><br><span class="line">        while (bottomEdge &amp;lt; getHeight() &amp;amp;&amp;amp; position &amp;lt; mAdapter.getCount()) &#123;</span><br><span class="line">            View newBottomChild = mAdapter.getView(position, null, this);</span><br><span class="line">            addAndMeasureChild(newBottomChild);</span><br><span class="line">            bottomEdge += newBottomChild.getMeasuredHeight();</span><br><span class="line">            position++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    positionItems();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>So，What happends hers? 首先执行父调用和空值检查，然后开始真正有用的代码。如果我们还没有添加任何子节点，那么我们就开始那么做。这个while循环直到我们添加足够多的视图覆盖整个屏幕为止。当我们从adapter获得一个视图，我们就把它添加为一个子节点，然后我们需要测量(measure)它，为的是得到它的正确尺寸。当我们添加完所有的视图，我们把它们放置到正确的位置.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Adds a view as a child view and takes care of measuring it</span><br><span class="line"> *</span><br><span class="line"> * @param child The view to add</span><br><span class="line"> */</span><br><span class="line">private void addAndMeasureChild(View child) &#123;</span><br><span class="line">    LayoutParams params = child.getLayoutParams();</span><br><span class="line">    if (params == null) &#123;</span><br><span class="line">        params = new LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);</span><br><span class="line">    &#125;</span><br><span class="line">    addViewInLayout(child, -1, params, true);</span><br><span class="line">    int itemWidth = getWidth();</span><br><span class="line">    child.measure(MeasureSpec.EXACTLY | itemWidth, MeasureSpec.UNSPECIFIED);</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * Positions the children at the &amp;quot;correct&amp;quot; positions</span><br><span class="line"> */</span><br><span class="line">private void positionItems() &#123;</span><br><span class="line">    int top = 0;</span><br><span class="line">    for (int index = 0; index &lt; getChildCount(); index++) &#123;</span><br><span class="line">        View child = getChildAt(index);</span><br><span class="line">        int width = child.getMeasuredWidth();</span><br><span class="line">        int height = child.getMeasuredHeight();</span><br><span class="line">        int left = (getWidth() - width) / 2;</span><br><span class="line">        child.layout(left, top, left + width, top + height);</span><br><span class="line">        top += height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这些代码比较简单，自解释，所以我不准备过多描述。虽然我在测量子视图时走了点捷径，但是这些代码在大部分情况下是工作良好的。positioItems()从top（0)开始，然后布局这些子视图，一个挨着一个，没有任何padding。值得注意的是，我们忽略了list可能有的padding.</p>
<h3 id="滑动"><a href="#滑动" class="headerlink" title="滑动"></a>滑动</h3><p>如果现在运行这些代码，我们在屏幕上得到一些东西了。然而，这一点交互的感觉也没有（interactive）。当我们触摸屏幕时它不会滑动，我们也不能点击任何item.要让触摸生效，我们需要重写 onTouchEvent()。</p>
<p>仅仅使其滑动的触摸逻辑是十分简单的，当我们得到一个按下事件，我们保存下按下事件的位置，和list的位置。我们将使用第一个item的top作为list的位置(position)，当我们获得一个移动事件，我们计算与按下事件的距离，然后根据开始位置和当前位置的距离重新安置list。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean onTouchEvent(MotionEvent event) &#123;</span><br><span class="line">    if (getChildCount() == 0) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    switch (event.getAction()) &#123;</span><br><span class="line">        case MotionEvent.ACTION_DOWN:</span><br><span class="line">            mTouchStartY = (int)event.getY();</span><br><span class="line">            mListTopStart = getChildAt(0).getTop();</span><br><span class="line">            break;</span><br><span class="line">        case MotionEvent.ACTION_MOVE:</span><br><span class="line">            int scrolledDistance = (int)event.getY() - mTouchStartY;</span><br><span class="line">            mListTop = mListTopStart + scrolledDistance;</span><br><span class="line">            requestLayout();</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在list的位置已经由mListTop确定下来了，无论何时它改变了，我实际上只需要请求重新布局就好了。我们之前实现的positionItem()总是从0开始布局。现在我们需要改变它，以至于它能从mListTop开始。</p>
<p>如果我们现在就去尝试滑动，它会表现的不错，但我们还是能发现一些明显的问题在我们的list中。首先，滑动没有限制，这样我们可以把所有的item滑出屏幕外。我们需要几种限制检查方式去阻止我们那样做。第二，如果我们往下滑，我们只能看到之前已经显示了的item。没有新的item显示出来，即使adapter包含了更多的item。我们现在就修复第二个问题，然后把第一个问题放到下一章再说。</p>
<h4 id="处理所有的item"><a href="#处理所有的item" class="headerlink" title="处理所有的item"></a>处理所有的item</h4><p>之所以在我们滑动式没有新的item出现，原因在于onLayout()这段代码。这段代码只会在没有一个视图未被添加的时候才会添加视图。<strong>(The code there only adds views if no views haven’t already been added.)</strong> list组件的必要条件之一就是无论它是有10个item还是10,000个item，它都应该工作正常。记住了这点，我们就不能简单地在开始的时候把所有的item从adapter拿出，然后全部添加为子视图，我们需要确定我们能高效地处理这些视图.为了做到高效，我们只需要持有list可见那部分的子视图。如果我们能维持一小块视图的缓存，最好不过了，我们能让adpater重用这些而不是反复的从xml中inflate。</p>
<p>处理这些问题的地方在onLayout()。新版本的onLayout()看起来像是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;</span><br><span class="line">    super.onLayout(changed, left, top, right, bottom);</span><br><span class="line">    // if we don&apos;t have an adapter, we don&apos;t need to do anything</span><br><span class="line">    if (mAdapter == null) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (getChildCount() == 0) &#123;</span><br><span class="line">        mLastItemPosition = -1;</span><br><span class="line">        fillListDown(mListTop);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        int offset = mListTop + mListTopOffset - getChildTop(getChildAt(0));</span><br><span class="line">        removeNonVisibleViews(offset);</span><br><span class="line">        fillList(offset);</span><br><span class="line">    &#125;</span><br><span class="line">    positionItems();</span><br><span class="line">    invalidate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>fillListDown()和之前的while循环或多或少是同一个东西。也添加了一个方法做同样的事情，只是它从顶部开始添加，叫做fillListUp()。他们都叫做fillList()。removeNonVisibleViews()把超出可见范围（超出顶部和底部）的视图移除掉。有两个变量被添加进来，为了跟踪视图，确保与adpater连接时在正确的位置：mFirstItemPosition和mLastPosition。它们是当前可见视图的在adpater中第一个和最后一个位置。每当我们移除或者添加一个视图，它都会更新。当滑动中的list滑到第一个可见item的顶部时，我们也需要更新list的位置，每当我们在顶部添加一个新视图或者移除顶部视图时。</p>
<p>为了弥补positionItems()将上下移动list的事实，我们需要让removeVisibleViews()和fillList()知道到底list移动了多少。这就是偏移变量(offset variable)。否则我们可能不会移除那些执行positionItems()时离开可见区域的items,或者我们可能忘了去添加将变为可见状态的items。当mListTop被定义为第一个item的顶部，即使它不可见，我们也需要跟踪当前第一个可见item到之前第一个item位置的距离。</p>
<p>如果你之前有实现过一个adapter，你应该知道检测并且使用convertView参数，代替每次从xml中inflat一个新的视图，这种方式来提升性能。现在我们正实现它的另一面，那就是我们将调用getView()而不是实现它，然后我们需要确定我们让adapter重用views。我们需要的是可以重用视图的缓存。标准的ListView支持不同种类的视图，但是现在我们假设所有的item-views是一样的。我们将只使用LinkedList来作为缓存容器.每当我们移除一个子视图时(在 removeNonVisibleViews())我们添加一个到缓存中，每当我们向adapter调用getView是（在fillListDown（）和fillListUp（））时，我们返回一个缓存视图（如果有的话）作为convertView。</p>
<p>###点击和长按</p>
<p>想让list变的有用的，那么就需要让在list中的所有item可以被点击。AdapterView实现了设置OnItemClickListener和OnItemLongClickLstener的方法，我们需要确认在合适的时间调用这些监听器。为了支持点击item的视图，我们需要做三件事情</p>
<ol>
<li>检测一个点击时间</li>
<li>找出被点击的item</li>
<li>调用监听器（如果设置了），携带正确的参数<br>那么从顶部开始，并且实现一个点击检测吧。</li>
</ol>
<p>Android提供的<a href="http://developer.android.com/reference/android/view/GestureDetector.html" target="_blank" rel="noopener">GestureDestector</a>类可以使用，但是我们事实上我不建议使用。其中一个原因是我发现它相当不可靠，特别是长按手势和甩手势。另一个原因是如果你委托手势检测到另一类的话，你可能无法追踪触摸状态，并且想要知道更多关于触摸状态的信息。</p>
<p>首先，定义一些触摸状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/** User is not touching the list */</span><br><span class="line">private static final int TOUCH_STATE_RESTING = 0;</span><br><span class="line">/** User is touching the list and right now it&apos;s still a &quot;click&quot; */</span><br><span class="line">private static final int TOUCH_STATE_CLICK = 1;</span><br><span class="line">/** User is scrolling the list */</span><br><span class="line">private static final int TOUCH_STATE_SCROLL = 2;</span><br></pre></td></tr></table></figure>
<p>我们事前已经重写过了OnTouchEvent()，现在我们将添加一些代码来处理新的状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"> public boolean onTouchEvent(final MotionEvent event) &#123;</span><br><span class="line">     if (getChildCount() == 0) &#123;</span><br><span class="line">         return false;</span><br><span class="line">     &#125;</span><br><span class="line">     switch (event.getAction()) &#123;</span><br><span class="line">         case MotionEvent.ACTION_DOWN:</span><br><span class="line">             startTouch(event);</span><br><span class="line">             break;</span><br><span class="line">         case MotionEvent.ACTION_MOVE:</span><br><span class="line">             if (mTouchState == TOUCH_STATE_CLICK) &#123;</span><br><span class="line">                 startScrollIfNeeded(event);</span><br><span class="line">             &#125;</span><br><span class="line">             if (mTouchState == TOUCH_STATE_SCROLL) &#123;</span><br><span class="line">                 scrollList((int)event.getY() - mTouchStartY);</span><br><span class="line">             &#125;</span><br><span class="line">             break;</span><br><span class="line">         case MotionEvent.ACTION_UP:</span><br><span class="line">             if (mTouchState == TOUCH_STATE_CLICK) &#123;</span><br><span class="line">                 clickChildAt((int)event.getX(), (int)event.getY());</span><br><span class="line">             &#125;</span><br><span class="line">             endTouch();</span><br><span class="line">             break;</span><br><span class="line">         default:</span><br><span class="line">             endTouch();</span><br><span class="line">             break;</span><br><span class="line">     &#125;</span><br><span class="line">     return true;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>在添加代码前，这段的大部分是相同的。处理按下事件的代码被重构为一个方法,startTouch()。同时我们将状态改变为TOUCH_STATE_CLICK。现在我们不知道用户是要点击或者滑动视图，但是直到我们识别为一个滑动，我们就处理它为一个点击。</p>
<p>滑动的识别是在startScrollIfNeeded()中处理的，在滑动事件函数（move events）中被调用的那个。比较当前触摸坐标和按下事件的坐标，如果用户手指滑动的距离超出了临界值，那么就改变状态为TOUCH_STATE_SCROLL。我使用10px的临界值，效果还不错。你也可以使用ViewConfiguraion类然后调用getScaledTouchSlop()获取的值作为临界值。</p>
<p>If we are scrolling,then it’s the same code as without the additions for click/state,though it’s now in a separate method.(眼花了).list的顶部被修改，布局被要求重新布置list。</p>
<p>为了支持点击事件，我们也需要处理好ACTION_UP事件，我们还需要确认我们把ACTION_CANCEL和ACTION_OUTSIDE事件区分开来。除了按下和移动事件，其他所有的事件我们都需要重置触摸状态为TOUCH_STATE_RESTING,已经在endTouch()中调用了，但是唯独ACTION_UP我们需要调用点击监听器。当然，我们只能调用点击监听器，如果我们是在点击状态而不是滑动状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">private void clickChildAt(final int x, final int y) &#123;</span><br><span class="line">    final int index = getContainingChildIndex(x, y);</span><br><span class="line">    if (index != INVALID_INDEX) &#123;</span><br><span class="line">        final View itemView = getChildAt(index);</span><br><span class="line">        final int position = mFirstItemPosition + index;</span><br><span class="line">        final long id = mAdapter.getItemId(position);</span><br><span class="line">        performItemClick(itemView, position, id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">private int getContainingChildIndex(final int x, final int y) &#123;</span><br><span class="line">    if (mRect == null) &#123;</span><br><span class="line">        mRect = new Rect();</span><br><span class="line">    &#125;</span><br><span class="line">    for (int index = 0; index &amp;lt; getChildCount(); index++) &#123;</span><br><span class="line">        getChildAt(index).getHitRect(mRect);</span><br><span class="line">        if (mRect.contains(x, y)) &#123;</span><br><span class="line">            return index;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return INVALID_INDEX;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>clickChildAt() is responsible for calling the listener (if any) with the position for the child at the specified coordinates. To find the correct view clickChildAt() uses getContainingChildIndex() which loops through the child views and for each view checks if the coordinates given are contained within the hit-rect of the view or not.</p>
<p>When we have click handling in place, adding a check for long press is quite simple. A convenient way of checking for a long press is to create a Runnable that calls the long press listener. Then whenever we get a down event we post this Runnable with a delay on the view). Whenever we get an up event or when we switch to scrolling, we know it’s not going to be a long press any more so then we simply remove the Runnable by calling <a href="http://developer.android.com/reference/android/view/View.html#removeCallbacks(java.lang.Runnable" target="_blank" rel="noopener">removeCallbacks()</a>). How long to check for a long-press is up to you and the specific view you are implementing, but if it’s not something special, it’s a good idea to use the same delay as the rest of the system. Use <a href="http://developer.android.com/reference/android/view/ViewConfiguration.html#getLongPressTimeout(" target="_blank" rel="noopener">ViewConfiguration.getLongPressTimeout()</a>) to get it.</p>
<p>In order to be able to scroll the list even if the child views respond to touch events, you need to intercept touch events when you want to start scrolling. This is done by overriding <a href="http://developer.android.com/reference/android/view/ViewGroup.html#onInterceptTouchEvent(android.view.MotionEvent" target="_blank" rel="noopener">onInterceptTouchEvent()</a>)  which lets us monitor all the touch events passed to our children and lets us, if we want to, intercept the touch events at any point.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean onInterceptTouchEvent(final MotionEvent event) &#123;</span><br><span class="line">    switch (event.getAction()) &#123;</span><br><span class="line">        case MotionEvent.ACTION_DOWN:</span><br><span class="line">            startTouch(event);</span><br><span class="line">            return false;</span><br><span class="line">        case MotionEvent.ACTION_MOVE:</span><br><span class="line">            return startScrollIfNeeded(event);</span><br><span class="line">        default:</span><br><span class="line">            endTouch();</span><br><span class="line">            return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The implementation of onInterceptTouchEvent() looks quite like onTouchEvent(). If we get a down event, we save the position of the list then return false to let the motion event pass to wherever it’s going. When we get move events, we check if we’ve moved far enough for this to be counted as a scroll move. If we have moved enough, we set the state to scrolling and then we return true to intercept future events.</p>
<p>####To be continued…<br>What we’ve made so far is a very simple list. We handle views efficiently and a user can scroll it and click and long press items. If we stop here however, we could just as well have used ListView (though we’ve learned a bit about implementing a view group). In the next part of this tutorial, we will take a look at canvas transformations and give the list a more 3D look and after that we will look into the dynamics of the list like bounce and fling effects.</p>
<p><a href="http://developer.sonymobile.com/downloads/code-example-module/3d-list-sample-project-part-1/" target="_blank" rel="noopener">[Download] 3D List sample project – Part 1 (31kb)</a></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/11/2013-05-11-custom-adapterview/" data-id="cjdnn3tkj0007rpfyflmzifkd" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-05-10-Detecting-Common-Gestures" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/10/2013-05-10-Detecting-Common-Gestures/">检测常见的手势 （译文）</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/10/2013-05-10-Detecting-Common-Gestures/">
            <time datetime="2013-05-09T16:00:00.000Z" itemprop="datePublished">2013-05-10</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>一个触摸手势发生在一个用户将一个或多个手指放在触摸屏上，然后你的应用将这些触摸事件(pattern)翻译为一个具体的手势。有两个相应的阶段去作手势检测:</p>
<ul>
<li>收集关于触摸事件的数据.</li>
<li>解释(interperting)这些数据，看它是否符合你的应用程序所支持的手势的标准(criteria).</li>
</ul>
<h3 id="支持包-类"><a href="#支持包-类" class="headerlink" title="支持包/类"></a>支持包/类</h3><p>本课程中的示例使用了GestureDetectorCompat 和MotionEventCompat 类.这些类在支持包中.当可能需要在Android 1.6或者更高的系统中使用时，你应该使用支持包。注意，MotionEventCompat <em>不是</em> MotionEvent类的替代版。相反，它提供了多种静态方法 ，为了接收已经结合事件的期望动作，传递你的MotionEvent对象。</p>
<h3 id="收集数据"><a href="#收集数据" class="headerlink" title="收集数据"></a>收集数据</h3><p>当用户将一个或多个手指放在屏幕上，在可接收触摸事件的视图上触发回调函数 onTouchEvent().对于每个触摸事件序列(位置，压力，大小，另一个手指的添加等),最终确定为一个手势，onTouchEvent()会多次调用(fired)</p>
<p>当用户第一次接触屏幕时，手势开始，系统追踪用户手指的位置，手势也跟着继续，直到捕获用户的手指离开屏幕时结束。始终相互作用，传递(delivered)到onTouchEvent()的MotionEvent提供了每个交互的细节。你的应用可以使用这些提供了MotionEvent的数据去决定是否一个手势动作发生了值得去关注。</p>
<h3 id="在Activity或者View中捕获触摸事件"><a href="#在Activity或者View中捕获触摸事件" class="headerlink" title="在Activity或者View中捕获触摸事件"></a>在Activity或者View中捕获触摸事件</h3><p>重载onTouchEvent()回调函数，以拦截触摸事件在Activity或者View</p>
<p>以下片段使用了getActionMasked()去提取用户从eventParameter执行的动作。它提供给你原始数据，由你决定是否一个手势是你关心发生的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line">// This example shows an Activity, but you would use the same approach if</span><br><span class="line">// you were subclassing a View.</span><br><span class="line">@Override</span><br><span class="line">public boolean onTouchEvent(MotionEvent event)&#123;</span><br><span class="line">    int action = MotionEventCompat.getActionMasked(event);</span><br><span class="line">    switch(action) &#123;</span><br><span class="line">        case (MotionEvent.ACTION_DOWN) :</span><br><span class="line">            Log.d(DEBUG_TAG,&quot;Action was DOWN&quot;);</span><br><span class="line">            return true;</span><br><span class="line">        case (MotionEvent.ACTION_MOVE) :</span><br><span class="line">            Log.d(DEBUG_TAG,&quot;Action was MOVE&quot;);</span><br><span class="line">            return true;</span><br><span class="line">        case (MotionEvent.ACTION_UP) :</span><br><span class="line">            Log.d(DEBUG_TAG,&quot;Action was UP&quot;);</span><br><span class="line">            return true;</span><br><span class="line">        case (MotionEvent.ACTION_CANCEL) :</span><br><span class="line">            Log.d(DEBUG_TAG,&quot;Action was CANCEL&quot;);</span><br><span class="line">            return true;</span><br><span class="line">        case (MotionEvent.ACTION_OUTSIDE) :</span><br><span class="line">            Log.d(DEBUG_TAG,&quot;Movement occurred outside bounds &quot; +</span><br><span class="line">                    &quot;of current screen element&quot;);</span><br><span class="line">            return true;      </span><br><span class="line">        default :</span><br><span class="line">            return super.onTouchEvent(event);</span><br><span class="line">    &#125;      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后你可以做你自己的处理在这些事件上，去决定一个手势是否发生。当你需要做一个定制的手势时，这是必须要做的过程。然而，如果你的应用使用常用的手势如双击，长按，扫等等，你可以使用GestureDetector类的优势。GestureDetector将事情简化，它不需要你自己处理个别的触摸时间就可以检测常见的手势.见讨论<a href="http://developer.android.com/training/gestures/detector.html#detect" target="_blank" rel="noopener">Detect Gestures</a></p>
<p>###在单个View中捕获触摸事件###</p>
<p>作为OnTouchEvent()的代替，你可以使用setOnTouchListener()方法将一个View.OnTouchListener依附(attach)到任何View对象上去。它使得我们无需子类化一个已经存在的View，而可以去监听触摸事件。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">View myView = findViewById(R.id.my_view);</span><br><span class="line">myView.setOnTouchListener(new OnTouchListener() &#123;</span><br><span class="line">    public boolean onTouch(View v, MotionEvent event) &#123;</span><br><span class="line">        // ... Respond to touch events      </span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果你创建了一个监听器，在处理ACTION_DOWN事件后返回 false ，你需要注意了。如果你这么做了，这个监听器将接收不到随后的ACTION_MOVE和ACTION_UP 事件（String of events)。这是因为ACTION_DOWN是所有触摸事件的触发点。</p>
<p>如果你创建了一个定制View，你可以重载onTouchEvent()，如以上讨论的。</p>
<p>###检测手势###</p>
<p>Android提供了GestureDetector类来检测通用手势，它支持了一些手势在onDown(),onLongPress(),onFling()等方法中。你可以结合OnTouchEvent()使用GestureDetector，如刚才讨论的。</p>
<p>###检测所有支持的手势###</p>
<p>当你实例化一个GestureDetectorCompat对象时，其中一个参数需要实现GestureDetector.OnGestureListener接口。GestureDetector.OnGestureListener通知用户何时一个特定的触摸事件发生。为了使你的GestureDetector对象可以接收事件，你需要重载View或者Activity的OnTouchEvent()方法，然后沿着所有被观察的事件传递到检测实例。</p>
<p>接下来的片段中，一个返回true的特定on&lt;TouchEvent&gt;意味着你已经处理了触摸时间。返回false则通过视图栈向下传递事件，直到触摸被成功处理。</p>
<p>执行下面的代码，感受下当你与屏幕互动(interact)时，动作是如何被触发的，以及每个触摸事件中MotionEvent的内容。你将会了解即使是单个交互动作有多少数据生产。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends Activity implements</span><br><span class="line">        GestureDetector.OnGestureListener,</span><br><span class="line">        GestureDetector.OnDoubleTapListener&#123;</span><br><span class="line">    private static final String DEBUG_TAG = &quot;Gestures&quot;;</span><br><span class="line">    private GestureDetectorCompat mDetector;</span><br><span class="line">    // Called when the activity is first created.</span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        // Instantiate the gesture detector with the</span><br><span class="line">        // application context and an implementation of</span><br><span class="line">        // GestureDetector.OnGestureListener</span><br><span class="line">        mDetector = new GestureDetectorCompat(this,this);</span><br><span class="line">        // Set the gesture detector as the double tap</span><br><span class="line">        // listener.</span><br><span class="line">        mDetector.setOnDoubleTapListener(this);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onTouchEvent(MotionEvent event)&#123;</span><br><span class="line">        this.mDetector.onTouchEvent(event);</span><br><span class="line">        // Be sure to call the superclass implementation</span><br><span class="line">        return super.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onDown(MotionEvent event) &#123;</span><br><span class="line">        Log.d(DEBUG_TAG,&quot;onDown: &quot; + event.toString());</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onFling(MotionEvent event1, MotionEvent event2,</span><br><span class="line">            float velocityX, float velocityY) &#123;</span><br><span class="line">        Log.d(DEBUG_TAG, &quot;onFling: &quot; + event1.toString()+event2.toString());</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void onLongPress(MotionEvent event) &#123;</span><br><span class="line">        Log.d(DEBUG_TAG, &quot;onLongPress: &quot; + event.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onScroll(MotionEvent e1, MotionEvent e2, float distanceX,</span><br><span class="line">            float distanceY) &#123;</span><br><span class="line">        Log.d(DEBUG_TAG, &quot;onScroll: &quot; + e1.toString()+e2.toString());</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void onShowPress(MotionEvent event) &#123;</span><br><span class="line">        Log.d(DEBUG_TAG, &quot;onShowPress: &quot; + event.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onSingleTapUp(MotionEvent event) &#123;</span><br><span class="line">        Log.d(DEBUG_TAG, &quot;onSingleTapUp: &quot; + event.toString());</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onDoubleTap(MotionEvent event) &#123;</span><br><span class="line">        Log.d(DEBUG_TAG, &quot;onDoubleTap: &quot; + event.toString());</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onDoubleTapEvent(MotionEvent event) &#123;</span><br><span class="line">        Log.d(DEBUG_TAG, &quot;onDoubleTapEvent: &quot; + event.toString());</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onSingleTapConfirmed(MotionEvent event) &#123;</span><br><span class="line">        Log.d(DEBUG_TAG, &quot;onSingleTapConfirmed: &quot; + event.toString());</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="检测一个被支持手势的子集"><a href="#检测一个被支持手势的子集" class="headerlink" title="检测一个被支持手势的子集"></a>检测一个被支持手势的子集</h3><p>如果你只是想要处理小部分的手势，你可以继承GestureDetector.SimpleOnGestureListener ，而不是GestureDetector.OnGestureListener接口。</p>
<p>GestureDetector.SimpleOnGestureListener 提供所有On&lt;TouchEvent&gt;方法返回false的实现.因此你可以只重载你所关心的方法。例如，接下来的片段创建了一个继承GestureDetector.SimpleOnGestureListener类，重载了OnFling()和OnDown();</p>
<p>无论你是否使用GestureDetector.OnGestureListener，这是一个最佳实践(best practice)去实现一个返回true的 onDown()方法。因为所有的手势开始与一个onDown()信息。如果你在onDown()返回false，GestureDetector.SimpleOnGestureListener只做默认动作，系统假定你要忽视手势的剩余部分(rest)，然后GestureDetector.OnGestureListener的其他方法将永远不会被调用。这可能是在你应用中的一个潜在异常(potential)。除非你真的是要忽略手势，你才应该返回false.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line">    private GestureDetectorCompat mDetector;</span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        mDetector = new GestureDetectorCompat(this, new MyGestureListener());</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onTouchEvent(MotionEvent event)&#123;</span><br><span class="line">        this.mDetector.onTouchEvent(event);</span><br><span class="line">        return super.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line">    class MyGestureListener extends GestureDetector.SimpleOnGestureListener &#123;</span><br><span class="line">        private static final String DEBUG_TAG = &quot;Gestures&quot;;</span><br><span class="line">        @Override</span><br><span class="line">        public boolean onDown(MotionEvent event) &#123;</span><br><span class="line">            Log.d(DEBUG_TAG,&quot;onDown: &quot; + event.toString());</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        @Override</span><br><span class="line">        public boolean onFling(MotionEvent event1, MotionEvent event2,</span><br><span class="line">                float velocityX, float velocityY) &#123;</span><br><span class="line">            Log.d(DEBUG_TAG, &quot;onFling: &quot; + event1.toString()+event2.toString());</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/10/2013-05-10-Detecting-Common-Gestures/" data-id="cjdnn3tka0001rpfy1id25rs4" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-05-10-movement" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/10/2013-05-10-movement/">追踪运动 (译文)</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/10/2013-05-10-movement/">
            <time datetime="2013-05-09T16:00:00.000Z" itemprop="datePublished">2013-05-10</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><a href="http://developer.android.com/training/gestures/movement.html" target="_blank" rel="noopener">源链接</a></p>
<p>本课程将讨论如何在触摸事件中追踪运动</p>
<p>一个新的onTouchEvent()是被一个ACTION_MOVE事件触发的，无论何时当前触摸包含位置，压力，或者大小改变。如在Detecting Common Gestures中讨论的，所有的事件被记录在onTouchEvent()中的MotionEvent参数中.</p>
<p>因为基于手指的触摸不总是精致的交互形式，检测触摸事件经常基于运动而不是单个触点。为了帮助应用区分(distingush)基于运动的手势（如 swipe）和非移动手势（如单击) ,Android包含了“touch slop”概念。Touch slop指的是在这个手势被解释为一个运动手势前， 用户触摸的像素距离。更多的这个主题的讨论，见 Managing Touch Events in a ViewGroup。</p>
<p>有不同方式去追踪手势运动，取决与你的应用需要，如：</p>
<ul>
<li>一个目标的开始与结束（如，移动一个在屏幕上的物体，从点A到点B)</li>
<li>目标点正运行的方向，通过x和y坐标的方向决定</li>
<li>History，你可以通过调用MotionEvent的getHistorySize()方法，找到一个手势的History信息。你可以通过MotionEvent的 getHistorical&lt;Value&gt;方法获得每个History事件的位置，大小，时间，压力。History信息对于渲染用户手指的路径(trail)十分有效，如为触摸绘画.参考更多细节MotionEvent。</li>
<li>目标移过触摸屏幕的速度。</li>
</ul>
<p>###跟踪速度</p>
<p>你可以获得一个简单的基于距离和(或)目标移动方向的运动手势，但是速度通常是在追踪手势特性甚至决定是否一个手势发生的决定性因素 。为了使计算速度更简单，Android提供了VelocityTracker类和VelocityTrackerCompat类在支持包中。VolocityTracker 帮助你追踪触摸事件的速度。对于某些将速度作为部分标准的手势，如扫，这是十分有用的。</p>
<p>以下这个示例，说明了VelocityTrackerAPI中的方法目的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends Activity &#123;</span><br><span class="line">    private static final String DEBUG_TAG = &quot;Velocity&quot;;</span><br><span class="line">        ...</span><br><span class="line">    private VelocityTracker mVelocityTracker = null;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean onTouchEvent(MotionEvent event) &#123;</span><br><span class="line">        int index = event.getActionIndex();</span><br><span class="line">        int action = event.getActionMasked();</span><br><span class="line">        int pointerId = event.getPointerId(index);</span><br><span class="line">        switch(action) &#123;</span><br><span class="line">            case MotionEvent.ACTION_DOWN:</span><br><span class="line">                if(mVelocityTracker == null) &#123;</span><br><span class="line">                    // Retrieve a new VelocityTracker object to watch the velocity of a motion.</span><br><span class="line">                    mVelocityTracker = VelocityTracker.obtain();</span><br><span class="line">                &#125;</span><br><span class="line">                else &#123;</span><br><span class="line">                    // Reset the velocity tracker back to its initial state.</span><br><span class="line">                    mVelocityTracker.clear();</span><br><span class="line">                &#125;</span><br><span class="line">                // Add a user&apos;s movement to the tracker.</span><br><span class="line">                mVelocityTracker.addMovement(event);</span><br><span class="line">                break;</span><br><span class="line">            case MotionEvent.ACTION_MOVE:</span><br><span class="line">                mVelocityTracker.addMovement(event);</span><br><span class="line">                // When you want to determine the velocity, call</span><br><span class="line">                // computeCurrentVelocity(). Then call getXVelocity()</span><br><span class="line">                // and getYVelocity() to retrieve the velocity for each pointer ID.</span><br><span class="line">                mVelocityTracker.computeCurrentVelocity(1000);</span><br><span class="line">                // Log velocity of pixels per second</span><br><span class="line">                // Best practice to use VelocityTrackerCompat where possible.</span><br><span class="line">                Log.d(&quot;&quot;, &quot;X velocity: &quot; +</span><br><span class="line">                        VelocityTrackerCompat.getXVelocity(mVelocityTracker,</span><br><span class="line">                        pointerId));</span><br><span class="line">                Log.d(&quot;&quot;, &quot;Y velocity: &quot; +</span><br><span class="line">                        VelocityTrackerCompat.getYVelocity(mVelocityTracker,</span><br><span class="line">                        pointerId));</span><br><span class="line">                break;</span><br><span class="line">            case MotionEvent.ACTION_UP:</span><br><span class="line">            case MotionEvent.ACTION_CANCEL:</span><br><span class="line">                // Return a VelocityTracker object back to be re-used by others.</span><br><span class="line">                mVelocityTracker.recycle();</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>你需要在ACTION_MOVE事件后计算速度，而不是ACTION_UP.如果你ACTION_UP后计算，X和Y速度将是0</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/10/2013-05-10-movement/" data-id="cjdnn3tkh0005rpfya34r51vj" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-05-10-intercept-touchevent" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/10/2013-05-10-intercept-touchevent/">当ViewPager嵌套在ScrollView/ListView里时，手势冲突如何处理？</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/10/2013-05-10-intercept-touchevent/">
            <time datetime="2013-05-09T16:00:00.000Z" itemprop="datePublished">2013-05-10</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>有时我们需要将ViewPager嵌套在其他已经含有手势动作的ViewGroup里,如ScrollView,ListView时，会造成手势冲突，如表现为ViewPager向左划时，不小心向上移动了一点距离，ViewPager立刻回弹到原始位置。</p>
<p>主要问题出在ScrollView/ListView作为ViewPager的ParentView，会先接受到触摸信息，而且他们对上下滑动是会做出拦截动作，并接管触摸信息的向下传递，导致ViewPager滑动异常。<br>先看一种<a href="http://justwyy.iteye.com/blog/1567390" target="_blank" rel="noopener">解决方式</a>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public class ScrollViewExtend extends ScrollView &#123;  </span><br><span class="line">    private float xDistance, yDistance, xLast, yLast;  </span><br><span class="line">    public ScrollViewExtend(Context context, AttributeSet attrs) &#123;  </span><br><span class="line">        super(context, attrs);  </span><br><span class="line">    &#125;  </span><br><span class="line">    @Override  </span><br><span class="line">    public boolean onInterceptTouchEvent(MotionEvent ev) &#123;  </span><br><span class="line">        switch (ev.getAction()) &#123;  </span><br><span class="line">            case MotionEvent.ACTION_DOWN:  </span><br><span class="line">                xDistance = yDistance = 0f;  </span><br><span class="line">                xLast = ev.getX();  </span><br><span class="line">                yLast = ev.getY();  </span><br><span class="line">                break;  </span><br><span class="line">            case MotionEvent.ACTION_MOVE:  </span><br><span class="line">                final float curX = ev.getX();  </span><br><span class="line">                final float curY = ev.getY();             </span><br><span class="line">                xDistance += Math.abs(curX - xLast);  </span><br><span class="line">                yDistance += Math.abs(curY - yLast);  </span><br><span class="line">                xLast = curX;  </span><br><span class="line">                yLast = curY;  </span><br><span class="line">                if(xDistance &gt; yDistance)&#123;  </span><br><span class="line">                    return false;  </span><br><span class="line">                &#125;    </span><br><span class="line">        &#125;  </span><br><span class="line">        return super.onInterceptTouchEvent(ev);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种方式的确可以解决这个问题，但是其实Google已经提供了一个函数来解决ParentView与ChildView手势冲突的问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public void requestDisallowInterceptTouchEvent(boolean disallowIntercept)</span><br></pre></td></tr></table></figure>
<p>由ViewPager在OnTouch/onInterceptTouchEvent，dispatchTouchEvent中调用即可。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/10/2013-05-10-intercept-touchevent/" data-id="cjdnn3tkf0004rpfye0szkrdy" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-05-10-action_mask" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/05/10/2013-05-10-action_mask/">ACTION_MASK 是用来干嘛的？</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/05/10/2013-05-10-action_mask/">
            <time datetime="2013-05-09T16:00:00.000Z" itemprop="datePublished">2013-05-10</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>我们经常可以看到这样的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int action=event.getAction();</span><br><span class="line">switch(action&amp;MotionEvent.ACTION_MASK)&#123;</span><br><span class="line">    // balabala</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从字面上理解，即为动作与上动作掩码.看下这些常量的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ACTION_MASK             0x000000ff</span><br><span class="line">ACTION_DOWN             0x00000000</span><br><span class="line">ACTION_UP               0x00000001  </span><br><span class="line">ACTION_MOVE             0x00000002</span><br><span class="line">ACTION_POINTER_DOWN     0x00000005</span><br><span class="line">ACTION_POINTER_UP       0x00000006</span><br><span class="line">ACTION_POINTER_1_DOWN   0x00000005            </span><br><span class="line">ACTION_POINTER_1_UP     0x00000006   </span><br><span class="line">ACTION_POINTER_2_DOWN   0x00000105   </span><br><span class="line">ACTION_POINTER_2_UP     0x00000106</span><br><span class="line">ACTION_POINTER_3_DOWN   0x00000205           </span><br><span class="line">ACTION_POINTER_3_UP     0x00000206</span><br></pre></td></tr></table></figure>
<p>我们发现单指DOWN/UP分别为 0x005和0x006,<br>而双值和三指DOWN/UP分别为 0x105和0x106,0x205和0x206</p>
<p>假设当前触摸动作为ACTION_POINTER_2_DOWN时，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int action=0x105;</span><br><span class="line">int maskAction=0x0ff&amp;0x105; //  maskAction=0x005;</span><br></pre></td></tr></table></figure>
<p>如此，触摸动作含义改变为ACTION_POINTER_DOWN</p>
<p>总结，Android在很多需要性能的地方都采用了这种传入int类型，再加掩码操作。如onMeasure。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/05/10/2013-05-10-action_mask/" data-id="cjdnn3tke0003rpfy18rlefda" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-2013-04-04-SoftInputMethod" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2013/04/04/2013-04-04-SoftInputMethod/">显示隐藏软键盘--InputMethodManager源码</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2013/04/04/2013-04-04-SoftInputMethod/">
            <time datetime="2013-04-03T16:00:00.000Z" itemprop="datePublished">2013-04-04</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Android/">Android</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>InputMethodManager主要是用来管理IME的相关操作的，如显示,隐藏,开关等,我们常会用到这么三个方法</p>
<ul>
<li>public void toggleSoftInputFromWindow(android.os.IBinder windowToken, int showFlags, int hideFlags)</li>
<li>public boolean hideSoftInputFromWindow(android.os.IBinder windowToken, int flags)</li>
<li>public void showSoftInputFromInputMethod(android.os.IBinder token, int flags)   </li>
</ul>
<p>showFlags,hideFlags是我们可以传入的参数常量，让我们看看文档里对它们的定义:</p>
<pre><code>/**
 * Flag for {@link #showSoftInput} to indicate that this is an implicit
 * request to show the input window, not as the result of a direct request
 * by the user.  The window may not be shown in this case.
 */
public static final int SHOW_IMPLICIT = 0x0001;

/**
 * Flag for {@link #showSoftInput} to indicate that the user has forced
 * the input method open (such as by long-pressing menu) so it should
 * not be closed until they explicitly do so.
 */
public static final int SHOW_FORCED = 0x0002;


/**
 * Flag for {@link #hideSoftInputFromWindow} to indicate that the soft
 * input window should only be hidden if it was not explicitly shown
 * by the user.
 */
public static final int HIDE_IMPLICIT_ONLY = 0x0001;

/**
 * Flag for {@link #hideSoftInputFromWindow} to indicate that the soft
 * input window should normally be hidden, unless it was originally
 * shown with {@link #SHOW_FORCED}.
 */
public static final int HIDE_NOT_ALWAYS = 0x0002;
</code></pre><p>可以看出SHOW_IMPLICIT(隐形显示)和HIDE_IMPLICIT_ONLY(隐形隐藏)是相对应的，</p>
<ol>
<li>假如用户显示时设置flag为SHOW_FORCED(强制显示)，那么当隐藏是设置HIDE_IMPLICIT_ONLY时，软键盘并不会隐藏。</li>
</ol>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2013/04/04/2013-04-04-SoftInputMethod/" data-id="cjdnn3tk60000rpfyqw3ou5ew" class="article-share-link"><i class="fa fa-share"></i>Compartir</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/2/">&laquo; Anterior</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
    </nav>
</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">Recientes</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/02/15/2017年年终总结/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/02/15/2017年年终总结/" class="title">2017年年终总结</a></p>
                            <p class="item-date"><time datetime="2018-02-14T21:59:27.000Z" itemprop="datePublished">2018-02-15</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/02/15/hello-world/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/02/15/hello-world/" class="title">Hello World</a></p>
                            <p class="item-date"><time datetime="2018-02-14T20:49:39.472Z" itemprop="datePublished">2018-02-15</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2013/11/28/2013-11-28-picasso/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
                            <p class="item-title"><a href="/2013/11/28/2013-11-28-picasso/" class="title">Android Picasso-强大的图片下载缓存类库</a></p>
                            <p class="item-date"><time datetime="2013-11-27T16:00:00.000Z" itemprop="datePublished">2013-11-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2013/10/30/2013-10-30-display-gif/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
                            <p class="item-title"><a href="/2013/10/30/2013-10-30-display-gif/" class="title">Android中显示动画的GIF-Movie类解决方案</a></p>
                            <p class="item-date"><time datetime="2013-10-29T16:00:00.000Z" itemprop="datePublished">2013-10-30</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2013/08/01/2013-08-01-dynamic_load/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
                            <p class="item-title"><a href="/2013/08/01/2013-08-01-dynamic_load/" class="title">Custom Class Loading in Dalvik (译)</a></p>
                            <p class="item-date"><time datetime="2013-07-31T16:00:00.000Z" itemprop="datePublished">2013-08-01</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">Categorias</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">25</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">Archivos</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">Etiquetas</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/work/">work</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">Nube de etiquetas</h3>
        <div class="widget tagcloud">
            <a href="/tags/work/" style="font-size: 10px;">work</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">Links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2018 Alin<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        


    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>